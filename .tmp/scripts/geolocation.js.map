{"version":3,"sources":["../../app/scripts/geolocation.js"],"names":[],"mappings":"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","file":"geolocation.js","sourcesContent":["/*old-jslint indent: 2, unparam: true, plusplus: true */\r\n/*\r\njslint\r\n    devel: true,\r\n    browser: true,\r\n    node: false\r\n*/\r\n/*\r\nglobal\r\n    $,\r\n    ol,\r\n    deferred: true\r\n    userDatas: true\r\n*/\r\n\r\n\r\n\r\nvar geolocationModule = (function () {\r\n    'use strict'; \r\n\r\n    /**\r\n     *\r\n     */\r\n     \r\n    var telizecomGeoip = function () {\r\n        \r\n        console.time('telize.com geolocation');\r\n        // http://www.telize.com/geoip?callback=?\r\n        return $.getJSON('http://www.telize.com/geoip', function (result) { \r\n            if (result.country_code) {\r\n                // alert(JSON.stringify(result));\r\n                $.when(appModule.deferred.ready.userProfile).done(function () {\r\n                    $('#user_profile').val(result.country_code).trigger('change');\r\n                    $('#user_country').val(result.country_code).trigger('change');\r\n                    $('#user_address').val(result.postal_code + ' ' + result.city + ', ' + result.country).trigger('change');\r\n                    userProfileModule.populateUserProfile(result.country_code.toLowerCase());\r\n                });\r\n                console.timeEnd('freegeoip.net geolocation');\r\n            } else {\r\n                console.warn('telize.com service returned an invalide JSON object');\r\n            }\r\n        }).fail(function () {\r\n            console.warn('telize.com service unvailable');\r\n        });\r\n            \r\n    };\r\n    \r\n    \r\n    \r\n    /**\r\n     *\r\n     */\r\n     \r\n    var freegeoipnetGeoip = function () {    \r\n        \r\n        console.time('freegeoip.net geolocation');\r\n        return $.getJSON('http://freegeoip.net/json/', function (result) {\r\n            if (result.country_code) {\r\n                // alert(JSON.stringify(result));\r\n                $.when(appModule.deferred.ready.userProfile).done(function () {\r\n                    $('#user_profile').val(result.country_code).trigger('change');\r\n                    $('#user_country').val(result.country_code).trigger('change');\r\n                    $('#user_address').val(result.zip_code + ' ' + result.city + ', ' + result.country_name).trigger('change');\r\n                    userProfileModule.populateUserProfile(result.country_code.toLowerCase());\r\n                });\r\n                console.timeEnd('freegeoip.net geolocation');\r\n            } else {\r\n                console.warn('freegeoip.net service returned an wrong data');\r\n            }\r\n        }).fail(function () {\r\n            console.warn('freegeoip.net service unvailable');\r\n        });\r\n        \r\n    };\r\n    \r\n    \r\n            \r\n    /**\r\n     * recenters the view by putting the given coordinates at 3/4 from the top or the screen\r\n     * geolocation-orientation\r\n     */\r\n\r\n    var _getCenterWithHeading = function (position, rotation, resolution) {\r\n        var size = mapModule.map.getSize();\r\n        var height = size[1];\r\n\r\n        return [\r\n            position[0] - Math.sin(rotation) * height * resolution * 1 / 4,\r\n            position[1] + Math.cos(rotation) * height * resolution * 1 / 4\r\n        ];\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * geolocation-orientation\r\n     */\r\n\r\n    var _addPosition = function (position, heading, m, speed) {\r\n        \r\n        var x = position[0];\r\n        var y = position[1];\r\n        var fCoords = positions.getCoordinates();\r\n        var previous = fCoords[fCoords.length - 1];\r\n        var prevHeading = previous && previous[2];\r\n        if (prevHeading) {\r\n            var headingDiff = heading - mod(prevHeading);\r\n\r\n            // force the rotation change to be less than 180ï¿½\r\n            if (Math.abs(headingDiff) > Math.PI) {\r\n              var sign = (headingDiff >= 0) ? 1 : -1;\r\n              headingDiff = - sign * (2 * Math.PI - Math.abs(headingDiff));\r\n            }\r\n            heading = prevHeading + headingDiff;\r\n        }\r\n        positions.appendCoordinate([x, y, heading, m]);\r\n\r\n        // only keep the 20 last coordinates\r\n        positions.setCoordinates(positions.getCoordinates().slice(-20));\r\n\r\n        // FIXME use speed instead\r\n        if (heading && speed) {\r\n            markerEl.src = 'images/geolocation_marker_heading.png';\r\n        } else {\r\n            markerEl.src = 'images/geolocation_marker.png';\r\n        }\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Reverse geocoding using openstreetmap nominative service\r\n     */\r\n\r\n    var _updateUserAddress = function () { // lon, lat\r\n\r\n        console.time(_updateUserAddress.name + ' function executed');\r\n\r\n        var position = geolocation.getPosition();\r\n        if (position) {\r\n            position = ol.proj.transform(position, 'EPSG:3857', 'EPSG:4326');\r\n            var url = 'http://nominatim.openstreetmap.org/reverse?format=json&lon=' + position[0] + '&lat=' + position[1] + '&zoom=1&addressdetails=1&format=json';\r\n\r\n            $.ajax({\r\n                url: url,\r\n                dataType: 'xml',\r\n                async: false,\r\n                success: function (json) {\r\n                    // var json = $.xml2json(xml);\r\n                    if (json && json.addressparts) {\r\n                        // console.log(JSON.stringify(json.addressparts));\r\n                        $('#user_address').val(json.addressparts.road + ', ' + json.addressparts.postcode + ' ' + json.addressparts.town + ', ' + json.addressparts.country);\r\n                        $('#user_profile').val(json.addressparts.country_code.toUpperCase()).trigger('change');\r\n                        userDatas.addressparts = json.addressparts;\r\n                    }\r\n                }\r\n            });\r\n\r\n        }\r\n\r\n        console.timeEnd(_updateUserAddress.name + ' function executed');\r\n    }\r\n\r\n\r\n\r\n    $.when(appModule.deferred.ready.map).then(function () { // , appModule.deferred.load.mapSettings\r\n\r\n        var geolocation = new ol.Geolocation(/** @type {olx.GeolocationOptions} */ ({\r\n            projection: mapModule.map.getView().getProjection(),\r\n            trackingOptions: {\r\n                maximumAge: 10000,\r\n                enableHighAccuracy: true,\r\n                timeout: 600000\r\n            }\r\n        }));\r\n\r\n        // LineString to store the different geolocation positions. This LineString is time aware.\r\n        // The Z dimension is actually used to store the rotation (heading).\r\n        var positions = new ol.geom.LineString([], /** @type {ol.geom.GeometryLayout} */ ('XYZM'));\r\n\r\n        var deltaMean = 500; // the geolocation sampling period mean in ms      \r\n\r\n        var previousM = 0;\r\n \r\n        // Try to define user location using a web service if there is no stored data\r\n        /*if (jQuery.isEmptyObject(way.get())) {\r\n            telizecomGeoip().fail(function() {\r\n                freegeoipnetGeoip();\r\n            });\r\n        }*/\r\n        \r\n        $(function () {\r\n\r\n            var markerEl = document.getElementById('geolocation_marker');\r\n            \r\n            mapModule.map.addOverlay(new ol.Overlay({\r\n                positioning: 'center-center',\r\n                element: markerEl,\r\n                stopEvent: false\r\n            }));\r\n            \r\n            // change center and rotation before render\r\n            mapModule.map.beforeRender(function(map, frameState) {\r\n                if (frameState !== null) {\r\n                    // use sampling period to get a smooth transition\r\n                    var m = frameState.time - deltaMean * 1.5;\r\n                    m = Math.max(m, previousM);\r\n                    previousM = m;\r\n                    // interpolate position along positions LineString\r\n                    var c = positions.getCoordinateAtM(m, true);\r\n                    var view = frameState.viewState;\r\n                    if (c) {\r\n                        //if ($gpsMode.attr('checked')) {\r\n                            view.center = _getCenterWithHeading(c, -c[2], view.resolution);\r\n                        //}\r\n                        //else {\r\n                        //    view.center = c;\r\n                        //}\r\n                        //if ($rotateMap.attr('checked')) {\r\n                            view.rotation = -c[2];\r\n                        //}\r\n                        //else {\r\n                        //    view.rotation = 0;\r\n                        //}\r\n                        markerEl.setPosition(c);\r\n                    }\r\n                }\r\n                return true; // Force animation to continue\r\n            });\r\n            \r\n            // Start / stop geolocation\r\n            $('#track').on('switchChange.bootstrapSwitch init', function () { // e, state\r\n            // $('#track').on('change', function () {\r\n                console.info((this.checked) ? '#track is checked' : '#track is not checked');\r\n                geolocation.setTracking(this.checked);\r\n                \r\n                if (this.checked) {\r\n                    $('#user_address').closest('.form-group').addClass('hidden');\r\n                    mapModule.map.on('postcompose', render);\r\n                    mapModule.map.render();\r\n                    var position = geolocation.getPosition();\r\n                    if (position) {\r\n                        mapModule.map.getView().setCenter(position);\r\n                    }\r\n                } else {\r\n                    $('#user_address').closest('.form-group').removeClass('hidden');\r\n                }\r\n            });\r\n            \r\n            // handle geolocation error.\r\n            geolocation.on('error', function (error) {\r\n                var info = document.getElementById('map_alert');\r\n                info.getElementsByTagName('div').innerHTML = error.message;\r\n                info.style.display = '';\r\n            });\r\n\r\n            // Listen to position changes\r\n            geolocation.on('change', function () {\r\n                var position = geolocation.getPosition(),\r\n                    accuracy = geolocation.getAccuracy(),\r\n                    heading = geolocation.getHeading() || 0,\r\n                    speed = geolocation.getSpeed() || 0,\r\n                    m = Date.now(),\r\n                    altitude = geolocation.getAltitude() || 0,\r\n                    altitudeAccuracy = geolocation.getAltitudeAccuracy() || 0,\r\n                    coords,\r\n                    len;\r\n\r\n                _addPosition(position, heading, m, speed);\r\n\r\n                coords = positions.getCoordinates();\r\n                len = coords.length;\r\n                if (len >= 2) {\r\n                    deltaMean = (coords[len - 1][3] - coords[0][3]) / (len - 1);\r\n                }\r\n\r\n                // position = ol.proj.transform(position, 'EPSG:3857', infoProjection);\r\n\r\n                view = mapModule.map.getView();\r\n                projection = view.getProjection();\r\n                var units = projection.getUnits();\r\n\r\n                $.when(appModule.deferred.load.mapSettings).then(function () {\r\n                    \r\n                    // $('#position').text(position[0].toFixed(2) + ', ' + position[1].toFixed(2) + ' deg');\r\n                    $('#longitude').text(position[0].toFixed(2) + ' ' + units);\r\n                    $('#latitude').text(position[1].toFixed(2) + ' ' + units);\r\n                    $('#accuracy').text(accuracy + ' ' + units);\r\n\r\n                    $('#heading').text(Math.round(radToDeg(heading)) + ' deg');\r\n                    $('#speed').text((speed * 3.6).toFixed(1) + ' km/h');\r\n                    // el('speed').text(geolocation.getSpeed() + ' m/s');\r\n                    $('#delta').text(Math.round(deltaMean) + ' ms');\r\n\r\n                    $('#altitude').text(altitude + ' m');\r\n                    $('#altitudeAccuracy').text(altitudeAccuracy + ' m');\r\n                    \r\n                });\r\n                \r\n            });\r\n\r\n            // Center map on user position on button click\r\n            $el = $('#center_map_on_user_location');\r\n            if ($el) {\r\n                $el.on('click', function (e) {\r\n                    e.preventDefault();\r\n                    var position = geolocation.getPosition();\r\n                    if (position) {\r\n                        mapModule.map.getView().setCenter(position);\r\n                        console.log('Map centered on user position');\r\n                    }\r\n\r\n                    _updateUserAddress();\r\n\r\n                });\r\n            }\r\n            \r\n            // Show / hide marker checkbox\r\n            var $el = $('#display_geolocation_marker');\r\n            if ($el) {\r\n                $el.on('switchChange.bootstrapSwitch', function () { // e, state\r\n                    if (this.checked) {\r\n                        $('#geolocation_marker').removeClass('hidden');\r\n                    } else {\r\n                        $('#geolocation_marker').addClass('hidden');\r\n                    }\r\n                }).trigger('switchChange.bootstrapSwitch');\r\n            }\r\n\r\n                \r\n            /*\r\n            // accuracy\r\n            var accuracyFeature = new ol.Feature();\r\n            accuracyFeature.bindTo('geometry', geolocation, 'accuracyGeometry');\r\n\r\n            // position\r\n            var positionFeature = new ol.Feature();\r\n            positionFeature.bindTo('geometry', geolocation, 'position')\r\n                .transform(function () {}, function (coordinates) {\r\n                    'use strict';\r\n                    return coordinates ? new ol.geom.Point(coordinates) : null;\r\n                });\r\n            */\r\n            \r\n            // Projection fields\r\n            // degrees', 'ft', 'm' or 'pixels\r\n            /*var $projection = $('#projection');\r\n            $projection.on('change', function () {\r\n              var projectionCode = $projection.val();\r\n              mapModule.map.control.MousePosition.setProjection(projectionCode);\r\n              mapModule.map.Geolocation.setProjection(projectionCode);\r\n            });*/\r\n\r\n\r\n            \r\n            // Device orientation __________________________________________________________________________\r\n            \r\n            var deviceOrientation = new ol.DeviceOrientation();\r\n\r\n            deviceOrientation.on('change', function () {\r\n\r\n                var alpha = deviceOrientation.getAlpha(),\r\n                    beta = deviceOrientation.getBeta(),\r\n                    gamma = deviceOrientation.getGamma(),\r\n                    heading = deviceOrientation.getHeading();\r\n\r\n                $('#alpha').text(alpha);\r\n                $('#alpha').text((alpha) ? radToDeg(alpha) + ' deg' : '-');\r\n                $('#beta').text((beta) ? radToDeg(beta) + ' deg' : '-');\r\n                $('#gamma').text((gamma) ? radToDeg(gamma) + ' deg' : '-');\r\n                $('#heading').text((heading) ? radToDeg(heading) + ' deg' : '-');\r\n                \r\n            });\r\n            \r\n            // tilt the map\r\n            deviceOrientation.on(['change:beta', 'change:gamma'], function (event) {\r\n                var view = mapModule.map.getView(),\r\n                    center = view.getCenter(),\r\n                    resolution = view.getResolution(),\r\n                    beta = event.target.getBeta() || 0,\r\n                    gamma = event.target.getGamma() || 0;\r\n\r\n                center[0] -= resolution * gamma * 25;\r\n                center[1] += resolution * beta * 25;\r\n\r\n                // view.setCenter(view.constrainCenter(center));\r\n\r\n            });\r\n        \r\n        });\r\n        \r\n    });\r\n\r\n})();"]}