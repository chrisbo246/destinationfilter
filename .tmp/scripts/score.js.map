{"version":3,"sources":["../../app/scripts/score.js"],"names":[],"mappings":"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","file":"score.js","sourcesContent":["/*old-jslint indent: 2, unparam: true, plusplus: true */\r\n/*\r\njslint\r\n    devel: true,\r\n    browser: true,\r\n    node: false,\r\n    this: true\r\n*/\r\n/*\r\nglobal\r\n    $,\r\n    deferred: true,,\r\n    prioritiesData: true,\r\n    oecdIncomeLevels: true\r\n*/\r\n/*\r\nexported\r\n    updateScores,\r\n    checkRequirements,\r\n    hasChanged\r\n*/\r\n \r\nvar scoreModule = (function () {\r\n    'use strict';\r\n    \r\n    /**\r\n     * Calculate scores\r\n     *\r\n     * @return { array } Datas for all countries\r\n     */\r\n\r\n    var updateScores = function () {\r\n\r\n        console.time('updateScores function executed');\r\n\r\n        var $this,\r\n            array,\r\n            countryChangeRate,\r\n            intersect,\r\n            length,\r\n            points,\r\n            enabledPriorities = {},\r\n            profile = {},\r\n            ratio,\r\n            // scoreRatio = 1,\r\n            // scoreValue = 0,\r\n            min,\r\n            max,\r\n            value,\r\n            values;\r\n\r\n\r\n\r\n        // Build an object of user profile values\r\n        $('#user_profile_form').find(':input[id]').each(function () {\r\n            $this = $(this);\r\n            if ($this.attr('id')) {\r\n                profile[$this.attr('id').toCamel()] = $this.val();\r\n            }\r\n        });\r\n\r\n        // Build an array or user scripts from his reading languages\r\n        $.when(languagesData).done(function () {\r\n            if ($.isArray(profile.userReadingLanguages) && languagesData) {\r\n                profile.userReadingScripts = [];\r\n                $.each(profile.userReadingLanguages, function (i, languageCode) {\r\n                    if ($.isPlainObject(languagesData[languageCode]) && languagesData[languageCode].ScriptCode) {\r\n                        profile.userReadingScripts.push(languagesData[languageCode].ScriptCode);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        // Define the strongest user money\r\n        if ($.isArray(profile.userCurrencies)) {\r\n            $.each(profile.userCurrencies, function (i, currencyCode) {\r\n                if (appModule.currenciesData[currencyCode] && appModule.currenciesData[currencyCode].eurExchangeRate && (!profile.userChangeRate || appModule.currenciesData[currencyCode].eurExchangeRate < profile.userChangeRate)) {\r\n                    profile.userChangeRate = parseFloat(appModule.currenciesData[currencyCode].eurExchangeRate); // .replace(/[, ]/g, '')\r\n                }\r\n            });\r\n        }\r\n\r\n        console.log('User profile: ' + JSON.stringify(profile));\r\n\r\n        // Start reading each countries to calculate scores\r\n        $.when(appModule.countriesData, appModule.currenciesData).done(function () {\r\n            \r\n            $.each(appModule.countriesData, function (cid, country) {\r\n\r\n                country.matchingPriorities = {};\r\n                country.points = 0;\r\n                country.missingDataPoints = 0;\r\n                country.percent = 0;\r\n                // country.maxPoints = maxPoints;\r\n\r\n                // Is the country use the same currency as the user?\r\n                // if (priorities.currency_priority) {\r\n                country.matchingPriorities.currencyPriority = {};\r\n                country.matchingPriorities.currencyPriority.required = [];\r\n\r\n                if (profile.userCurrencies) {\r\n                    country.matchingPriorities.currencyPriority.values = [];\r\n\r\n                    if (country.CurrencyCode) {\r\n                        intersect = $.intersect(\r\n                            profile.userCurrencies,\r\n                            [country.CurrencyCode]\r\n                        ).length;\r\n                        if (intersect > 0) {\r\n                            country.matchingPriorities.currencyPriority.values.push(1);\r\n                        }\r\n                    } else {\r\n                        country.matchingPriorities.currencyPriority.missing = true;\r\n                    }\r\n\r\n                } else {\r\n                    country.matchingPriorities.currencyPriority.required.push('user_currencies');\r\n                }\r\n\r\n                // }\r\n\r\n                // Is the country neighborhood to the user one?\r\n                // if (priorities.neighbor_priority) {\r\n                country.matchingPriorities.neighborPriority = {};\r\n                country.matchingPriorities.neighborPriority.required = [];\r\n                country.matchingPriorities.neighborPriority.values = [];\r\n\r\n                if (profile.userCountry) {\r\n\r\n                    if (country.neighbours) {\r\n                        // if (cid === 'au'){console.warn(profile.userCountry+' in '+country.neighbours);}\r\n                        if ($.inArray(profile.userCountry, country.neighbours) !== -1 || country.ISO === profile.userCountry) {\r\n                            country.matchingPriorities.neighborPriority.values.push(1);\r\n                        }\r\n                    } else {\r\n                        country.matchingPriorities.neighborPriority.missing = true;\r\n                    }\r\n\r\n                } else {\r\n                    country.matchingPriorities.neighborPriority.required.push('user_country');\r\n                }\r\n\r\n                // }\r\n\r\n                // Is that most of the population speak user language?\r\n                // if (priorities.speaking_language_priority) {\r\n                country.matchingPriorities.speakingLanguagePriority = {};\r\n                country.matchingPriorities.speakingLanguagePriority.required = [];\r\n                country.matchingPriorities.speakingLanguagePriority.values = [];\r\n\r\n                if (profile.userSpeakingLanguages) {\r\n                    if (country.languagePopulation) {\r\n                        $.each(country.languagePopulation, function (j, language) {\r\n                            intersect = $.intersect(\r\n                                profile.userSpeakingLanguages,\r\n                                [language.type]\r\n                            ).length;\r\n                            if (intersect > 0) {\r\n                                country.matchingPriorities.speakingLanguagePriority.values\r\n                                    .push(language.populationPercent);\r\n                            } else {\r\n                                country.matchingPriorities.speakingLanguagePriority.values\r\n                                    .push(0);\r\n                            }\r\n                        });\r\n                    } else {\r\n                        country.matchingPriorities.speakingLanguagePriority.missing = true;\r\n                    }\r\n\r\n                } else {\r\n                    country.matchingPriorities.speakingLanguagePriority.required.push('user_speaking_languages');\r\n                }\r\n\r\n                // }\r\n\r\n                // Will I be able to read signs?\r\n                // if (priorities.reading_language_priority) {\r\n                country.matchingPriorities.readingLanguagePriority = {};\r\n                country.matchingPriorities.readingLanguagePriority.required = [];\r\n                country.matchingPriorities.readingLanguagePriority.values = [];\r\n\r\n                if (profile.userReadingScripts) {\r\n\r\n                    if (country.languagePopulation) {\r\n                        $.each(country.languagePopulation, function (j, language) {\r\n                            if (language.officialStatus) {\r\n                                intersect = $.intersect(\r\n                                    profile.userReadingScripts,\r\n                                    [language.ScriptCode]\r\n                                ).length;\r\n                                if (intersect > 0 && $.inArray(\r\n                                    language.officialStatus,\r\n                                    ['official', 'de_facto_official', 'official_regional']\r\n                                ) !== -1) {\r\n                                    country.matchingPriorities.readingLanguagePriority.values\r\n                                        .push(1); // .push(scoreValue)\r\n                                }\r\n                            }\r\n                            /*else {\r\n                                                            country.matchingPriorities.readingLanguagePriority.missing = true;\r\n                                                        }*/\r\n                        });\r\n                    } else {\r\n                        country.matchingPriorities.readingLanguagePriority.missing = true;\r\n                    }\r\n\r\n                } else {\r\n                    country.matchingPriorities.readingLanguagePriority.required.push('userReadingScripts');\r\n                }\r\n\r\n                // }\r\n\r\n                // VISA\r\n\r\n                country.matchingPriorities.visaFreePriority = {};\r\n                country.matchingPriorities.voaFeePriority = {};\r\n                country.matchingPriorities.onwardTicketPriority = {};\r\n                country.matchingPriorities.visaFreePriority.values = [];\r\n                country.matchingPriorities.voaFeePriority.values = [];\r\n                country.matchingPriorities.onwardTicketPriority.values = [];\r\n                country.matchingPriorities.visaFreePriority.required = [];\r\n                country.matchingPriorities.voaFeePriority.required = [];\r\n                country.matchingPriorities.onwardTicketPriority.required = [];\r\n\r\n                if (profile.userCitizenships) {\r\n\r\n                    // If this is user country, no visa is required\r\n                    if (country.ISO) {\r\n\r\n                        /*intersect = $.intersect(\r\n                            profile.userCitizenships,\r\n                            [country.ISO]\r\n                        ).length;*/\r\n\r\n                        if ($.inArray(country.ISO, profile.userCitizenships) !== -1) {\r\n                            country.matchingPriorities.visaFreePriority.values.push(300);\r\n                            country.matchingPriorities.voaFeePriority.values.push(1);\r\n                            country.matchingPriorities.onwardTicketPriority.values.push(1);\r\n                        }\r\n                    }\r\n\r\n                    /*if (intersect > 0) {\r\n                      if (priorities.visa_free_priority) {\r\n                        country.matchingPriorities.visaFreePriority = {\r\n                          'values': [300]\r\n                        };\r\n                      }\r\n                      if (priorities.onward_ticket_priority) {\r\n                        country.matchingPriorities.onwardTicketPriority = {\r\n                          'values': [scoreValue]\r\n                        };\r\n                      }\r\n                    } else*/\r\n                    if (country.touristVisas) {\r\n\r\n                        // Else check requirements for each countries\r\n                        $.each(country.touristVisas, function (i, visa) {\r\n                            /*intersect2 = $.intersect(\r\n                                profile.userCitizenships,\r\n                                [visa.originCountryISO]\r\n                            ).length;*/\r\n                            if ($.inArray(visa.originCountryISO, profile.userCitizenships) !== -1) {\r\n\r\n                                // Visa-free\r\n                                if (visa.visaFreeLimit || visa.visaFreeLimit === 0) {\r\n                                    if (visa.visaFreeLimit > 0) {\r\n                                        country.matchingPriorities.visaFreePriority.values.push(visa.visaFreeLimit);\r\n                                    } else if (visa.visaFreeLimit === 'unlimited') {\r\n                                        country.matchingPriorities.visaFreePriority.values.push(300);\r\n                                    }\r\n                                }\r\n\r\n                                // visa on arrival fee\r\n                                if (!visa['voa-fee']) {\r\n                                    country.matchingPriorities.voaFeePriority.values.push(1);\r\n                                } else {\r\n                                    country.matchingPriorities.voaFeePriority.missing = true;\r\n                                }\r\n\r\n                                // onward-ticked\r\n                                if (!visa.requirements || $.inArray('onward-ticket', visa.requirements) === -1) {\r\n                                    country.matchingPriorities.onwardTicketPriority.values.push(1);\r\n                                } else {\r\n                                    country.matchingPriorities.onwardTicketPriority.missing = true;\r\n                                }\r\n\r\n                            }\r\n\r\n                        });\r\n\r\n                    } else {\r\n                        country.matchingPriorities.visaFreePriority.missing = true;\r\n                        country.matchingPriorities.voaFeePriority.missing = true;\r\n                        country.matchingPriorities.onwardTicketPriority.missing = true;\r\n                    }\r\n\r\n                } else {\r\n                    country.matchingPriorities.visaFreePriority.required = ['user_citizenships'];\r\n                    country.matchingPriorities.voaFeePriority.required = ['user_citizenships'];\r\n                    country.matchingPriorities.onwardTicketPriority.required = ['user_citizenships'];\r\n                }\r\n\r\n                // Is that the country use the same Voltage as the user?\r\n                // if (priorities.ac_voltages_priority || priorities.ac_plugs_priority) {\r\n\r\n                country.matchingPriorities.acPlugsPriority = {};\r\n                country.matchingPriorities.acPlugsPriority.required = [];\r\n                country.matchingPriorities.acPlugsPriority.values = [];\r\n\r\n                // if (country.ISO === 'FR') {console.warn('profile.userPlugVoltages: '+profile.userPlugVoltages);}\r\n                if (profile.userPlugTypes) {\r\n\r\n                    if (country.plugs) {\r\n                        $.each(country.plugs, function (i, plug) {\r\n\r\n                            // if (plug['Plug Type']) {\r\n                            //    value = plug['Plug Type'].replace(/Type /g, '');\r\n                            if (plug.plugType) {\r\n                                value = plug.plugType;\r\n                                intersect = $.intersect(\r\n                                    profile.userPlugTypes,\r\n                                    [value]\r\n                                ).length;\r\n                                if (intersect > 0) {\r\n                                    country.matchingPriorities.acPlugsPriority.values.push(1);\r\n                                }\r\n                            } else {\r\n                                country.matchingPriorities.acPlugsPriority.missing = true;\r\n                            }\r\n\r\n                        });\r\n                    } else {\r\n                        country.matchingPriorities.acPlugsPriority.missing = true;\r\n                    }\r\n\r\n                } else {\r\n                    country.matchingPriorities.acPlugsPriority.required.push('user_plug_types');\r\n                }\r\n\r\n\r\n                country.matchingPriorities.acVoltagesPriority = {};\r\n                country.matchingPriorities.acFrequenciesPriority = {};\r\n                country.matchingPriorities.acVoltagesPriority.required = [];\r\n                country.matchingPriorities.acFrequenciesPriority.required = [];\r\n                country.matchingPriorities.acVoltagesPriority.values = [];\r\n                country.matchingPriorities.acFrequenciesPriority.values = [];\r\n\r\n                if (profile.userPlugVoltages && profile.userPlugFrequencies) {\r\n                    if (country.plugs) {\r\n                        $.each(country.plugs, function (i, plug) {\r\n\r\n                            // console.info('Freq: ' + JSON.stringify(plug.frequencies) + ' in ' + console.info(JSON.stringify(profile.userPlugFrequencies.map(Number))));\r\n                            if (plug.frequencies) {\r\n                                // values = plug.Frequency.replace(/[^0-9.,]/g, '').split(',').map(Number);\r\n                                values = plug.frequencies\r\n                                intersect = $.intersect(\r\n                                    profile.userPlugFrequencies.map(Number),\r\n                                    values\r\n                                ).length;\r\n\r\n                                if (intersect > 0) {\r\n                                    country.matchingPriorities.acFrequenciesPriority.values.push(1);\r\n\r\n                                    if (plug.electricPotentials) {\r\n                                        // value = plug['Electric Potential'].replace(/[^0-9.,]/g, '').split(',').map(Number);\r\n                                        /*values = plug.electricPotentials;\r\n                                        intersect = $.intersect(\r\n                                            profile.userPlugVoltages.map(Number),\r\n                                            values\r\n                                        ).length;\r\n                                        if (intersect > 0) {*/\r\n\r\n                                        $.each(profile.userPlugVoltages.map(Number), function (i1, v1) {\r\n                                                $.each(plug.electricPotentials, function (i2, v2) {\r\n                                                    // console.info(country.Country+' '+v1+' '+v2+' '+Math.abs(v1 - v2));\r\n                                                    country.matchingPriorities.acVoltagesPriority.values.push(Math.abs(v1 - v2));\r\n                                                    // min = Math.min(min, Math.abs(v1 - v2));\r\n                                                });\r\n                                            });\r\n                                            // country.matchingPriorities.acVoltagesPriority.values.push(min);\r\n                                            // country.matchingPriorities.acVoltagesPriority.values.push(Math.abs(v1 - v2));\r\n                                        // }\r\n                                    } else {\r\n                                        country.matchingPriorities.acVoltagesPriority.missing = true;\r\n                                    }\r\n\r\n                                } else {\r\n                                    country.matchingPriorities.acFrequenciesPriority.values.push(0);\r\n                                }\r\n\r\n                            } else {\r\n                                country.matchingPriorities.acFrequenciesPriority.missing = true;\r\n                            }\r\n                        });\r\n                    } else {\r\n                        country.matchingPriorities.acVoltagesPriority.missing = true;\r\n                        country.matchingPriorities.acFrequenciesPriority.missing = true;\r\n                    }\r\n\r\n                } else {\r\n                    country.matchingPriorities.acVoltagesPriority.required.push('user_plug_voltages');\r\n                }\r\n                // }\r\n\r\n\r\n\r\n                // Democratic level\r\n                country.matchingPriorities.democracyPriority = {};\r\n                country.matchingPriorities.democracyPriority.required = [];\r\n                country.matchingPriorities.democracyPriority.values = [];\r\n\r\n                // Get max / min value for each country priorities\r\n                if (country.democracy && country.democracy.Score) {\r\n                    country.matchingPriorities.democracyPriority.values.push(country.democracy.Score);\r\n                } else {\r\n                    country.matchingPriorities.democracyPriority.missing = true;\r\n                }\r\n\r\n\r\n\r\n                // Is the change rate advantageous for the user?\r\n                // if (priorities.change_rate_priority) {\r\n                country.matchingPriorities.changeRatePriority = {};\r\n                country.matchingPriorities.changeRatePriority.required = [];\r\n                country.matchingPriorities.changeRatePriority.values = [];\r\n\r\n                // if (country.ISO === 'FR') {console.warn('profile.userCurrencies: '+profile.userCurrencies);}\r\n                if (profile.userCurrencies && profile.userChangeRate) {\r\n\r\n                    if (appModule.currenciesData && appModule.currenciesData[country.currency.CurrencyCode] && appModule.currenciesData[country.currency.CurrencyCode].eurExchangeRate) {\r\n\r\n                        // Country official currency value in euro (low rate)\r\n                        countryChangeRate = parseFloat(appModule.currenciesData[country.currency.CurrencyCode].eurExchangeRate); // .replace(/[, ]/g, '')\r\n\r\n                        // Get max / min value for each country priorities\r\n                        if (countryChangeRate) {\r\n                            // if (ratio <= 1) {\r\n                            ratio = profile.userChangeRate / countryChangeRate;\r\n                            country.matchingPriorities.changeRatePriority.values.push(Math.min(ratio, 1)); // Math.min(ratio, 1)\r\n                            // scoreRatio = (1 - ratio);\r\n                            // country.matchingPriorities.changeRatePriority.values.push((1 - ratio));\r\n                            // }\r\n                        } else {\r\n                            country.matchingPriorities.changeRatePriority.required.push('userChangeRate');\r\n                        }\r\n\r\n                    } else {\r\n                        country.matchingPriorities.changeRatePriority.missing = true;\r\n                    }\r\n\r\n                } else {\r\n                    country.matchingPriorities.changeRatePriority.required.push('user_currencies');\r\n                }\r\n                // }\r\n\r\n\r\n\r\n                // Income level\r\n                country.matchingPriorities.incomeLevelPriority = {};\r\n                country.matchingPriorities.incomeLevelPriority.required = [];\r\n                country.matchingPriorities.incomeLevelPriority.values = [];\r\n\r\n                if (profile.userIncomeLevel) {\r\n                    if (country.incomeLevel && country.incomeLevel.id) {\r\n                        value = ~~profile.userIncomeLevel - ~~oecdIncomeLevels[country.incomeLevel.id];\r\n                        country.matchingPriorities.incomeLevelPriority.values.push(Math.max(value, 0));\r\n                    } else {\r\n                        country.matchingPriorities.incomeLevelPriority.missing = true;\r\n                    }\r\n                } else {\r\n                    country.matchingPriorities.incomeLevelPriority.required.push('user_income_level');\r\n                }\r\n\r\n\r\n\r\n                // Driving side\r\n                // if (priorities.drivingSidePriority) {\r\n                country.matchingPriorities.drivingSidePriority = {};\r\n                country.matchingPriorities.drivingSidePriority.required = [];\r\n                country.matchingPriorities.drivingSidePriority.values = [];\r\n\r\n                if (profile.userDrivingSides) {\r\n\r\n                    if (country.drivingSide) {\r\n                        intersect = $.intersect(\r\n                            profile.userDrivingSides,\r\n                            [country.drivingSide]\r\n                        ).length;\r\n                        if (intersect > 0) {\r\n                            country.matchingPriorities.drivingSidePriority.values.push(1);\r\n                        }\r\n                    } else {\r\n                        country.matchingPriorities.drivingSidePriority.missing = true;\r\n                    }\r\n\r\n                } else {\r\n                    country.matchingPriorities.drivingSidePriority.required.push('user_driving_sides');\r\n                }\r\n                // }\r\n\r\n                // Religion\r\n                // if (priorities.religion_priority) {\r\n                country.matchingPriorities.religionPriority = {};\r\n                country.matchingPriorities.religionPriority.required = [];\r\n                country.matchingPriorities.religionPriority.values = [];\r\n\r\n                if (profile.userReligion) {\r\n\r\n                    if (country.religions) {\r\n                        $.each([profile.userReligion], function (i, religion) {\r\n                            if (country.religions[religion]) {\r\n                                country.matchingPriorities.religionPriority.values.push(~~country.religions[religion].percent);\r\n                            }\r\n                        });\r\n                    } else {\r\n                        country.matchingPriorities.religionPriority.missing = true;\r\n                    }\r\n\r\n                } else {\r\n                    country.matchingPriorities.religionPriority.required.push('user_religion');\r\n                }\r\n                // }\r\n\r\n\r\n                // Is that the country is an island or have islands\r\n                // if (priorities.island_priority) {\r\n                country.matchingPriorities.islandPriority = {};\r\n                country.matchingPriorities.islandPriority.values = [];\r\n\r\n                if (country.islands) {\r\n                    country.matchingPriorities.islandPriority.values.push(1);\r\n                } else {\r\n                    country.matchingPriorities.islandPriority.missing = true;\r\n                }\r\n\r\n                // }\r\n\r\n                // Better life index\r\n                $.when(prioritiesData).done(function () {\r\n\r\n                    $.each(prioritiesData, function (i, priorityData) {\r\n\r\n                        var indicator = priorityData.bliIndicator;\r\n                        var pid = priorityData.id;\r\n                        \r\n                        if (indicator && pid) {\r\n                            \r\n                            country.matchingPriorities[pid] = {};\r\n                            country.matchingPriorities[pid].values = [];\r\n\r\n                            if (country.betterLifeIndexes) {\r\n                                $.each(country.betterLifeIndexes, function (i, bli) {\r\n                                    if (bli.INDICATOR === indicator && bli.INEQUALITY === 'TOT') {\r\n                                        country.matchingPriorities[pid].values.push(bli.Value);\r\n                                    }\r\n                                });\r\n                            } else {\r\n                                country.matchingPriorities[pid].missing = true;\r\n                            }\r\n                        }\r\n\r\n                    });\r\n                });\r\n\r\n            });\r\n\r\n            $.when(prioritiesData).done(function () {\r\n                \r\n                // Points to give for each priorities\r\n                // The more priority is high, the more it will get points\r\n                // If priority is disabled, give 0 point\r\n                array = $('#enabled_priorities').sortable('toArray');\r\n                length = array.length;\r\n                if (!length) {\r\n                    array = $('#disabled_priorities').sortable('toArray');\r\n                }\r\n                var maxPoints = 0;               \r\n               \r\n                $.each(array, function (i, pid) {\r\n                    enabledPriorities[pid] = {};\r\n\r\n                    // Extend enabled priorities data with priorities.json\r\n                    $.each(prioritiesData, function (i, priority) {\r\n                        if (priority.id === pid) {\r\n                            $.extend(enabledPriorities[pid], priority);\r\n                            enabledPriorities[pid].reverse = $('#' + pid).find('.reverse-priority').prop('checked');\r\n                        }\r\n                    });\r\n\r\n                    // Define for each priority the maximum of points allowed\r\n                    var priorityRatio = 1;\r\n                    var $el = $('#priority_ratio');\r\n                    if ($el && $el.val()) {\r\n                        priorityRatio = $el.val();\r\n                    }\r\n\r\n                    if (length > 0) {\r\n                        enabledPriorities[pid].points = (array.length - i) * priorityRatio * 100;\r\n                    } else {\r\n                        enabledPriorities[pid].points = 100;\r\n                    }\r\n                    console.info('enabledPriorities['+pid+'].points='+enabledPriorities[pid].points);\r\n\r\n                    // Calculate the maximum of points a country can have (global var)\r\n                    maxPoints = maxPoints + enabledPriorities[pid].points;\r\n\r\n                    // Define the minimum and maximum value returned for each priority of each country\r\n                    $.each(appModule.countriesData, function (cid, country) {\r\n\r\n                        if (pid === 'acVoltagesPriority' && cid === 'au') console.info('appModule.countriesData['+cid+'].matchingPriorities['+pid+']='+JSON.stringify(country.matchingPriorities[pid]));\r\n                        if (country.matchingPriorities[pid]\r\n                            // && country.matchingPriorities[pid].values\r\n                            && $.isArray(country.matchingPriorities[pid].values)\r\n                            && country.matchingPriorities[pid].values.length > 0) { //  && country.matchingPriorities[pid].values.length > 0\r\n\r\n                            if (pid === 'acVoltagesPriority' && cid === 'au') console.info('Array.max('+JSON.stringify(country.matchingPriorities[pid].values)+', '+enabledPriorities[pid].maxValue+')');\r\n                            max = Math.max.apply(Math, country.matchingPriorities[pid].values.map(Number));\r\n                            enabledPriorities[pid].maxValue = (enabledPriorities[pid].maxValue || enabledPriorities[pid].maxValue === 0) ? Math.max(max, enabledPriorities[pid].maxValue) : max;\r\n                            if (pid === 'acVoltagesPriority' && cid === 'au') console.info(cid+': enabledPriorities['+pid+'].maxValue='+enabledPriorities[pid].maxValue);\r\n\r\n                            if (pid === 'acVoltagesPriority' && cid === 'au') console.info('Array.min('+JSON.stringify(country.matchingPriorities[pid].values)+', '+enabledPriorities[pid].minValue+')');\r\n                            min = Math.min.apply(Math, country.matchingPriorities[pid].values.map(Number));\r\n                            enabledPriorities[pid].minValue = (enabledPriorities[pid].minValue || enabledPriorities[pid].minValue === 0) ? Math.min(min, enabledPriorities[pid].minValue) : min;\r\n                            if (pid === 'acVoltagesPriority' && cid === 'au') console.info(cid+': enabledPriorities['+pid+'].minValue='+enabledPriorities[pid].minValue);\r\n\r\n                        } else {\r\n                            country.missingDataPoints = country.missingDataPoints + enabledPriorities[pid].points;\r\n                        }\r\n                    });\r\n\r\n                    if (pid === 'acVoltagesPriority') console.info('enabledPriorities['+pid+'].points=' + ~~enabledPriorities[pid].points + ' enabledPriorities['+pid+'].maxValue=' + ~~enabledPriorities[pid].maxValue + ' enabledPriorities['+pid+'].minValue=' + ~~enabledPriorities[pid].minValue);\r\n                    if ((enabledPriorities[pid].points || enabledPriorities[pid].points === 0)\r\n                        && (enabledPriorities[pid].maxValue || enabledPriorities[pid].maxValue === 0)\r\n                        && (enabledPriorities[pid].minValue || enabledPriorities[pid].minValue === 0)) {\r\n\r\n                        ratio = enabledPriorities[pid].points / ((enabledPriorities[pid].maxValue - enabledPriorities[pid].minValue) || 1);\r\n                        // ratio = enabledPriorities[pid].points / (enabledPriorities[pid].maxValue || 1);\r\n                        if (pid === 'acVoltagesPriority') console.info('enabledPriorities['+pid+'].ratio='+ratio);\r\n\r\n                        $.each(appModule.countriesData, function (cid, country) {\r\n\r\n                            // if (pid === 'acVoltagesPriority' && cid === 'au') console.info('appModule.countriesData['+cid+'].matchingPriorities['+pid+'].values='+JSON.stringify(country.matchingPriorities[pid].values));\r\n\r\n                            // If the country have several matching values\r\n                            if (country.matchingPriorities[pid] && country.matchingPriorities[pid].values && country.matchingPriorities[pid].values.length > 0) {\r\n\r\n                                max = Math.max.apply(Math, country.matchingPriorities[pid].values);\r\n                                points = (max - enabledPriorities[pid].minValue) * ratio;\r\n                                if (pid === 'acVoltagesPriority' && cid === 'au') console.info('max(' + JSON.stringify(country.matchingPriorities[pid].values)+ ') = ' + max);\r\n                                if (pid === 'acVoltagesPriority' && cid === 'au') console.info('points = ('+max+' - '+enabledPriorities[pid].minValue+') * '+ratio+'='+points);\r\n\r\n                                if (enabledPriorities[pid].reverse) {\r\n                                    //min = Math.min.apply(Math, country.matchingPriorities[pid].values);\r\n                                    //points = (min - enabledPriorities[pid].minValue || min) * ratio;\r\n                                    //if (pid === 'acVoltagesPriority' && cid === 'au') {console.info('min='+min)};\r\n                                    //if (pid === 'acVoltagesPriority' && cid === 'au') {console.info('points='+points)};\r\n                                    points = enabledPriorities[pid].points - points;\r\n                                }\r\n\r\n                                country.matchingPriorities[pid].points = points;\r\n                                country.matchingPriorities[pid].percent = country.matchingPriorities[pid].points / enabledPriorities[pid].points * 100;\r\n                                if (pid === 'acVoltagesPriority' && cid === 'au') console.info('appModule.countriesData['+cid+'].matchingPriorities['+pid+'].points='+country.matchingPriorities[pid].points);\r\n                                if (pid === 'acVoltagesPriority' && cid === 'au') console.info('appModule.countriesData['+cid+'].matchingPriorities['+pid+'].percent='+country.matchingPriorities[pid].percent);\r\n\r\n                                // Add points to the country total\r\n                                country.points = country.points + points;\r\n                                if (pid === 'acVoltagesPriority' && cid === 'au') console.info('appModule.countriesData['+cid+'].points='+appModule.countriesData[cid].points);\r\n\r\n                            }\r\n                        });\r\n                    }\r\n\r\n                });\r\n                \r\n                // Once the total has been calculate, convert points to percent\r\n                console.info('maxPoints='+maxPoints);\r\n                $.each(appModule.countriesData, function (cid, country) {\r\n                    country.percent = country.points / maxPoints * 100;\r\n                    country.missingDataPercent = country.missingDataPoints / maxPoints * 100;\r\n                    if (cid === 'au') console.info('appModule.countriesData['+cid+'].percent='+appModule.countriesData[cid].percent);\r\n                });\r\n                \r\n            });\r\n\r\n        });\r\n\r\n        console.timeEnd('updateScores function executed');\r\n\r\n        return true;\r\n\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Check if required fields are filled correctly\r\n     *\r\n     * @return { boolean }\r\n     */\r\n\r\n    var checkRequirements = function () {\r\n\r\n        console.time('checkRequirements function executed');\r\n\r\n        var requirements = true;\r\n\r\n        // Check if required profile fields are not empty\r\n        /*   $('#profile_form').find(':input').each(function () {\r\n            var $this = $(this);\r\n            if ($this.attr('id')) { userData[$this.attr('id')] = $this.val(); }\r\n            userData[$this.attr('id') + '_name'] = $this.children('option:selected').text();\r\n            if (!$this.val()) { requirements = false; }\r\n          });*/\r\n\r\n        // Check if required settings fields are not empty\r\n        /*$('#enabled_priorities_form').find(':input').each(function () {\r\n          if (!$(this).val()) {\r\n            requirements = false;\r\n          }\r\n        });*/\r\n\r\n        // Check if at least one priority is defined\r\n        if ($('#enabled_priorities').sortable('toArray').length < 1) {\r\n            requirements = false;\r\n        }\r\n\r\n        // Show #results if all requirements are satisfied\r\n        /*if (requirements) {\r\n          $('#results').show();\r\n        } else {\r\n          $('#results').hide();\r\n        }*/\r\n\r\n        console.timeEnd('checkRequirements function executed');\r\n\r\n        return requirements;\r\n\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Check if some fields change so we need to refresh results\r\n     *\r\n     * @return { boolean }\r\n     */\r\n\r\n    var hasChanged = function () {\r\n\r\n        console.time('hasChanged function executed');\r\n\r\n        var changed = false,\r\n            id,\r\n            value,\r\n            $this;\r\n\r\n        // Define a static variable to store each fields values\r\n        if (!hasChanged.fields) {\r\n            hasChanged.fields = [];\r\n        }\r\n\r\n        // Check if profile fields or settings changed\r\n        $('#profile_form').find(':input')\r\n            .each(function () {\r\n                $this = $(this);\r\n                if ($this.attr('id')) {\r\n                    id = $this.attr('id');\r\n                    value = $this.val();\r\n                    if ($.isArray(value)) {\r\n                        value = value.join(',');\r\n                    }\r\n                    if (value && (!hasChanged.fields[id] || value !== hasChanged.fields[id])) {\r\n                        changed = true;\r\n                        hasChanged.fields[id] = value;\r\n                    }\r\n                }\r\n            });\r\n\r\n        // Check if priorities changed\r\n        id = 'enabled_priorities';\r\n        value = $('#enabled_priorities').sortable('toArray').join(',');\r\n        if (!hasChanged.fields[id] || value !== hasChanged.fields[id]) {\r\n            changed = true;\r\n            hasChanged.fields[id] = value;\r\n        }\r\n\r\n        console.timeEnd('hasChanged function executed');\r\n\r\n        return changed;\r\n\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * Get scores and update map and country list\r\n     */\r\n\r\n     /*\r\n    var updateResults = function () {\r\n\r\n        console.time('updateResults function executed');\r\n        // alert('Update score');\r\n\r\n        // if (checkRequirements()\r\n        //    && hasChanged()\r\n        //    // && $('#results').visible(true, true, 'vertical')\r\n        //    ) {\r\n        //  scoreModule.updateScores();\r\n        //  drawCountryList();\r\n        //  drawMap();\r\n        // }\r\n\r\n        if (\r\n            $('#disabled_priorities').hasClass('ui-sortable') // .data('sortable')\r\n            // $('#profile_form').isValid()\r\n            //  && $('#priorities').sortable('toArray').length < 1\r\n            //  && hasChanged()\r\n        ) {\r\n                        var $el = $('#profile_form');\r\n                $el.bootstrapValidator('validate');\r\n            scoreModule.updateScores();\r\n            drawCountryList();\r\n            // drawMap();\r\n        }\r\n\r\n        console.timeEnd('updateResults function executed');\r\n\r\n    }\r\n    */\r\n\r\n\r\n    \r\n    // Load priorities from JSON file\r\n    var prioritiesData = {};  \r\n    console.time('Load disabledPrioritiesModal.json');  \r\n    $.getJSON('data/disabledPrioritiesModal.json', function (json) {\r\n        prioritiesData = json;        \r\n        console.timeEnd('Load disabledPrioritiesModal.json');\r\n    }).promise(prioritiesData);\r\n    \r\n    var languagesData = {};\r\n    console.time('Load languages.json');\r\n    $.getJSON('data/languages.json', function (json) {\r\n        languagesData = json;\r\n        console.timeEnd('Load languages.json');\r\n    }).promise(languagesData);\r\n    \r\n    return {\r\n        updateScores: updateScores\r\n        // checkRequirements: checkRequirements,\r\n        // hasChanged: hasChanged,\r\n        // updateResults: updateResults\r\n    };\r\n    \r\n})();"]}