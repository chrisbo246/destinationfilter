{"version":3,"sources":["../../app/scripts/countryListController.js"],"names":[],"mappings":"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","file":"countryListController.js","sourcesContent":["/*old-jslint indent: 2, unparam: true, plusplus: true */\r\n/*\r\njslint\r\n    devel: true,\r\n    browser: true,\r\n    node: false\r\n*/\r\n/*\r\nglobal\r\n    $,\r\n    Handlebars,\r\n    initBlock,\r\n    updateScores,\r\n    deferred: true,\r\n    options: true,\r\n    maxPoints: true\r\n*/\r\n\r\nvar countryListModule = (function () {\r\n    'use strict';\r\n    \r\n    var options = {\r\n\r\n        resultLimit: 100\r\n\r\n    };\r\n\r\n\r\n    /**\r\n     * Display matching country list\r\n     *\r\n     * @params { array } datas\r\n     */\r\n\r\n    var _drawCountryList = function () {\r\n        console.time('_drawCountryList function executed');\r\n\r\n        var sorted,\r\n            countryData,\r\n            data,\r\n            viewData = {},\r\n            // tmpl,\r\n            i = 0;\r\n\r\n        $.when(appModule.countriesData).done(function () {\r\n            console.log('- appModule.countriesData',appModule.countriesData);\r\n            \r\n            // Create an array of ids/points sorted by points\r\n            sorted = [];\r\n            $.each(appModule.countriesData, function (cid, v) {\r\n                sorted.push({\r\n                    id: cid,\r\n                    row: i,\r\n                    points: v.points\r\n                });\r\n                i = i + 1;\r\n            });\r\n            sorted.sort(function (x, y) {\r\n                return y.points - x.points;\r\n            });\r\n\r\n            // Display sorted country list\r\n            viewData.countries = [];\r\n            $.each(sorted, function (i, v) {\r\n\r\n                // if (appModule.countriesData[v.id].points > 0 && maxPoints\r\n                // && appModule.countriesData[v.id].maxPoints && appModule.countriesData[v.id].maxPoints > 0\r\n                if (!options || !options.resultLimit || i < options.resultLimit) {\r\n\r\n                    countryData = appModule.countriesData[v.id];\r\n                    console.log('appModule.countriesData['+v.id+']', countryData);\r\n                    data = $.extend(true, {}, countryData, {\r\n                        id: v.id,\r\n                        //i18nId: countryData.ISO,\r\n                        row: v.row,\r\n                        flag: {\r\n                            src: 'images/flags/' + countryData.codes.ISO3.toLowerCase() + '.svg'\r\n                        }\r\n                    });\r\n\r\n                    // data.countryName = 'values.countries.' + v.id.toUpperCase(); // appModule.i18n.t('country.' + v.id.toUpperCase()) // countryData.Country\r\n\r\n                    if (countryData.percent >= 0) { //&& maxPoints\r\n                        data.percent = countryData.percent.toFixed();\r\n                    }\r\n\r\n                    // Check if no data where missing for score calcul, else display a warning icon\r\n                    if (countryData.matchingPriorities) {\r\n                        $.each(countryData.matchingPriorities, function (i, matchingPriority) {\r\n\r\n                            if (matchingPriority.required && matchingPriority.required.length > 0) {\r\n                                data.warning = true;\r\n                            }\r\n                            if (matchingPriority.missing) {\r\n                                data.error = true;\r\n                            }\r\n\r\n                        });\r\n                    }\r\n\r\n                    viewData.countries.push(data);\r\n\r\n                }\r\n            });\r\n\r\n            $.get('templates/partials/countryListView.hbs', function (source) {\r\n\r\n                var $el,\r\n                template;\r\n\r\n                template = Handlebars.compile(source);\r\n\r\n                // Delete previous results\r\n                // $('[data-anchor=\"country_list\"]').empty();\r\n\r\n                $('[data-anchor=\"country_list\"]').html(template(viewData));\r\n\r\n                // Initialize jQuery plugins in this freshly generated block\r\n                appModule.initBlock('[data-anchor=\"country_list\"]');\r\n\r\n                // Update result limit when user change a setting\r\n                $el = $('#result_limit');\r\n                if ($el) {\r\n                    $el.on('change', function () {\r\n                        options.resultLimit = $el.val();\r\n                    });\r\n                }\r\n\r\n            });\r\n\r\n            console.timeEnd('_drawCountryList function executed');\r\n            \r\n        });\r\n        \r\n    }\r\n    \r\n\r\n\r\n    $(function () {\r\n        \r\n        \r\n        $.when(appModule.countriesData, appModule.deferred.ready.userProfile, appModule.deferred.ready.priorities).done(function () {//, appModule.deferred.ready.appSettings\r\n            \r\n            scoreModule.updateScores();            \r\n            _drawCountryList();\r\n\r\n            // Validate user profile and redraw country list each time #home_pane pane become visible\r\n            $('.navbar').find('a[data-toggle=\"tab\"]').on('shown.bs.tab', function (e) {\r\n                var pane_id = $(e.target).attr('href');\r\n                if (pane_id === '#home_pane') {\r\n                    scoreModule.updateScores();\r\n                    _drawCountryList();\r\n                }\r\n            });\r\n\r\n        });\r\n\r\n        // Copy to clipboard button\r\n        /*$('#copy-to-clipboard').zclip({\r\n          afterCopy: function () {\r\n            alert('The list of destinations has been saved in your clipboard and is ready to be pasted'\r\n              + ' into a document.');\r\n          },\r\n          copy: function () {\r\n            return $('#country_list_container').html()\r\n              // Remove buttons and links\r\n              // .replace(/<(button|a)\\s+((?!<\\/\\1>)[\\w\\W])+<\\/\\1>/g, '')\r\n              // Replace </h3></li></ul></div> end tags by line breaks\r\n              .replace(/<\\/(h[1-6]|li|ul|ol|div)>/g, '\\n')\r\n              // Replace ok icon by +\r\n              .replace(/<span class=\"glyphicon glyphicon-ok\">/g, '+')\r\n              // Replace remove icon by -\r\n              .replace(/<span class=\"glyphicon glyphicon-remove\">/g, '-')\r\n              // Remove all other tags\r\n              .replace(/<((?!>)[\\w\\W])+>/g, '');\r\n          },\r\n          path: 'js/vendor/ZeroClipboard.swf'\r\n        });*/\r\n        \r\n    });\r\n\r\n})();\r\n\r\n"]}