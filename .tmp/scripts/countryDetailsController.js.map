{"version":3,"sources":["../../app/scripts/countryDetailsController.js"],"names":[],"mappings":"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","file":"countryDetailsController.js","sourcesContent":["/*old-jslint indent: 2, unparam: true, plusplus: true */\r\n/*\r\njslint\r\n    devel: true,\r\n    browser: true,\r\n    node: false\r\n*/\r\n/*\r\nglobal\r\n    $,\r\n    Handlebars,\r\n    initBlock,\r\n    fitCountry,\r\n    deferred: true,\r\n    userData: true\r\n*/\r\n/*\r\nexported\r\n    showCountryDetails\r\n*/\r\n\r\nvar countryDetailsModule = (function () {\r\n    'use strict';\r\n        \r\n    /**\r\n     * Build country details template and open country details modal\r\n     *\r\n     * @param {string} cid - Country ID\r\n     * @param {string} format - ISO or ISO3\r\n     */\r\n    var showCountryDetails = function (cid, format) {\r\n        \r\n        console.log('showCountryDetails(' + cid + ', ' + format + ')');\r\n        if (!cid) return; \r\n            \r\n        $.when(appModule.countriesData, appModule.currenciesData).done(function () {\r\n        \r\n            if (format === 'ISO3') {\r\n                cid = countryCodesISO2[cid];\r\n                console.log('Country code converted to ISO2', cid);\r\n            }\r\n            cid = cid.toLowerCase();\r\n            var countryData = appModule.countriesData[cid];\r\n            \r\n            if (!countryData) {\r\n                console.warn('Missing appModule.countriesData[' + cid + ']');\r\n                $('#country_details').modal('hide');    \r\n                return;\r\n            }\r\n        \r\n            _buildTemplate(countryData);\r\n            \r\n        });\r\n        \r\n    };\r\n        \r\n    \r\n\r\n    /**\r\n     * Build and display country details view\r\n     * @param {Object} countryData - Country data (json)\r\n     */    \r\n    var _buildTemplate = function (countryData) {\r\n        \r\n        var array,\r\n            // iconClass,\r\n            // colorClass,\r\n            rows,\r\n            // percent,\r\n            data,\r\n            str = {},\r\n            // template,\r\n            userCitizenships,\r\n            userCountry,\r\n            viewData;\r\n        \r\n        if (!countryData) {\r\n            return;\r\n        }\r\n        \r\n        // Adapt visa requirements to user citizenship\r\n        str.citizenships = [];\r\n        console.info('touristVisas: ' + JSON.stringify(countryData.touristVisas) + ' #user_citizenships' + JSON.stringify($('#user_citizenships').val()));\r\n        userCitizenships = $('#user_citizenships').val();\r\n        if (countryData.touristVisas && userCitizenships) {\r\n            console.info('userCitizenships: ' + JSON.stringify(userCitizenships));\r\n            $.each(countryData.touristVisas, function (i, v) {\r\n                console.log('Is ' + v.originCountryISO + ' in ' + JSON.stringify(userCitizenships));\r\n                if ($.inArray(v.originCountryISO, userCitizenships) !== -1) {\r\n                    console.info('Is ' + v.originCountryISO + ' in ' + JSON.stringify(userCitizenships));\r\n                    var citizenshipId = v.originCountryISO.toLowerCase(),\r\n                        // country = {},\r\n                        href;\r\n                    /*\r\n                    country.country = appModule.countriesData[v.originCountryISO.toLowerCase()].Country;\r\n                    country.visaFreeLimit = (v.visaFreeLimit === 'unlimited') ? 'Unlimited' : 'Up to ' + v.visaFreeLimit + ' days';\r\n                    country.voaFee = v['voa-fee'] || 'none';\r\n                    country.requirements = (v.requirements) ? v.requirements.join(',') : 'none';\r\n                    */\r\n\r\n                    if (countryData.slugs && countryData.slugs['visahq.com']) {\r\n                        var url = 'https://' + countryData.slugs['visahq.com'] + '.visahq.com/requirements/';\r\n                        if (citizenshipId && appModule.countriesData[citizenshipId] && appModule.countriesData[citizenshipId].slugs['visahq.com']) {\r\n                            href = url;\r\n                            if (appModule.countriesData[citizenshipId].slugs['visahq.com']) {\r\n                                href = href + appModule.countriesData[citizenshipId].slugs['visahq.com'] + '/';\r\n                            }\r\n                            var userCountryId = $('#user_country').val().toLowerCase();\r\n                            if (userCountryId && appModule.countriesData[userCountryId].slugs['visahq.com']) {\r\n                                href = href + 'resident-' + appModule.countriesData[userCountryId].slugs['visahq.com'] + '/';\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    str.citizenships.push($.extend(true, {}, v, {\r\n                        //'citizenship': appModule.countriesData[citizenshipId].Country,\r\n                        'href': href\r\n                    }));\r\n\r\n                    // str.citizenships.push(country);\r\n                }\r\n            });\r\n        }\r\n        console.info('Citizenships: ' + JSON.stringify(str.citizenships));\r\n\r\n\r\n        // Adapt change rate to user currencies\r\n        if (countryData.currency.CurrencyCode && $('#user_currencies').val()) {\r\n            str.userCurrencies = [];\r\n            $.each($('#user_currencies').val(), function (i, currencyCode) {\r\n                var currencyName,\r\n                    localCurrencyValue,\r\n                    currencyData;\r\n                if (appModule.currenciesData && appModule.currenciesData[currencyCode] && appModule.currenciesData[currencyCode].eurExchangeRate > 0) {\r\n                    currencyName = appModule.currenciesData[currencyCode].CcyNm;\r\n                    localCurrencyValue = appModule.currenciesData[currencyCode].eurExchangeRate;\r\n                } else {\r\n                    currencyName = appModule.currenciesData.EUR.CcyNm;\r\n                    localCurrencyValue = 1;\r\n                }\r\n                currencyData = appModule.currenciesData[countryData.currency.CurrencyCode];\r\n                if (currencyData && currencyCode !== 'EUR') {\r\n                    str.userCurrencies.push({\r\n                        'currencyValue': (1 / (currencyData.eurExchangeRate / localCurrencyValue)).toFixed(2),\r\n                        'currencyName': currencyName,\r\n                        'localCurrencyValue': (currencyData.eurExchangeRate / localCurrencyValue).toFixed(2),\r\n                        'localCurrencyName': currencyData.CcyNm,\r\n                        'changeRateURL': 'http://www.xe.com/fr/currencyconverter/convert/?Amount=1&From=' + currencyCode + '&To=' + countryData.currency.CurrencyCode\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n        // URLs\r\n        str.costOfLivingURL = 'http://www.numbeo.com/cost-of-living/';\r\n        if (countryData.slugs) {\r\n            // str.climatURL = 'http://www.weather-and-climate.com/average-monthly-Rainfall-Temperature-' + 'Sunshine-in-' + countryData.slug.charAt(0).toUpperCase() + countryData.slug.slice(1);\r\n            str.climatURL = 'http://www.weather-and-climate.com/average-monthly-Rainfall-Temperature-' + 'Sunshine-in-' + countryData.slugs['weather-and-climate.com'];\r\n            // $('#user_country').val().toLowerCase() // userData.user_country.toLowerCase()\r\n            str.embassiesURL = 'http://embassy.goabroad.com/embassies-in/' + countryData.slugs['goabroad.com'];\r\n            // console.warn(JSON.stringify(userData));\r\n            // console.warn($('#user_country').val());\r\n            if (userData && userData.address && userData.address.ISO) {\r\n                userCountry = userData.address.ISO;\r\n            } else if ($('#user_country').val()) {\r\n                userCountry = $('#user_country').val();\r\n            }\r\n            if (userCountry && countryData.slugs['goabroad.com'] && userCountry.toLowerCase() !== cid.toLowerCase()) {\r\n                str.localEmbassiesURL = 'http://embassy.goabroad.com/embassies-of-' + countryData.slugs['goabroad.com'];\r\n                if (appModule.countriesData[userCountry.toLowerCase()] && appModule.countriesData[userCountry.toLowerCase()].slugs['goabroad.com']) {\r\n                    str.localEmbassiesURL = str.localEmbassiesURL + '-in-' + appModule.countriesData[userCountry.toLowerCase()].slugs['goabroad.com'];\r\n                }\r\n            }\r\n\r\n            // str.costOfLivingURL = 'http://www.numbeo.com/cost-of-living/country_result.jsp?country=' + countryData.slug.charAt(0).toUpperCase() + countryData.slug.slice(1);\r\n            str.costOfLivingURL = 'http://www.numbeo.com/cost-of-living/country_result.jsp?country=' + countryData.slugs['numbeo.com'];\r\n\r\n            // str.visaFreeURL = 'http://embassy-finder.com/' + countryData.slugs['default'] + '_visa';\r\n\r\n\r\n\r\n            str.betterLifeIndexURL = 'http://www.oecdbetterlifeindex.org/countries/' + countryData.slug + '/';\r\n        }\r\n        // str.plugTypesURL = 'http://www.iec.ch/worldplugs/list_bylocation.htm';\r\n\r\n        // Matches\r\n        if (countryData.points) {\r\n            str.fixedScore = countryData.points.toFixed();\r\n        }\r\n\r\n        str.matches = [];\r\n        array = $('#enabled_priorities').sortable('toArray');\r\n        if (!array.length) {\r\n            array = $('#disabled_priorities').sortable('toArray');\r\n        }\r\n        $.each(array, function (i, pid) {\r\n\r\n            data = {\r\n                id: pid\r\n            };\r\n\r\n            if (countryData.matchingPriorities[pid]) {\r\n                if (countryData.matchingPriorities[pid].percent >= 0) {\r\n                    // data.percent = countryData.matchingPriorities[pid].percent;\r\n                    data.percent = countryData.matchingPriorities[pid].percent.toFixed();\r\n                }\r\n                if (countryData.matchingPriorities[pid].required\r\n                  && countryData.matchingPriorities[pid].required.length > 0) {\r\n                    data.warning = true;\r\n                }\r\n                if (countryData.matchingPriorities[pid].missing) {\r\n                    data.error = true;\r\n                }\r\n            }\r\n\r\n            /*if (countryData.matchingPriorities[pid] && countryData.matchingPriorities[pid].values) {\r\n                data.iconClass = 'glyphicon glyphicon-info-sign text-info';\r\n                if (countryData.matchingPriorities[pid].percent > 0) {\r\n                    data.percent = (countryData.matchingPriorities[pid].percent * 100).toFixed();\r\n                    data.iconClass = 'glyphicon glyphicon-ok text-success';\r\n                }\r\n            }*/\r\n\r\n            str.matches.push(data);\r\n        });\r\n\r\n        // Better life indexes\r\n        if (countryData.betterLifeIndexes) {\r\n            rows = {};\r\n            $.each(countryData.betterLifeIndexes, function (i, v) {\r\n                if (!rows[v.INDICATOR]) {\r\n                    rows[v.INDICATOR] = {};\r\n                }\r\n                // rows[v.INDICATOR].INDICATOR = v.INDICATOR;\r\n                // rows[v.INDICATOR][v.INEQUALITY] = Math.round(v.Value * 100) / 100;\r\n                rows[v.INDICATOR][v.INEQUALITY] = $.extend({}, v, {\r\n\r\n                });\r\n            });\r\n            str.bli = rows;\r\n        }\r\n\r\n        /*str.bli.units = {\r\n            AVSCORE: 'averageScore',\r\n            HOUR: 'hours',\r\n            MICRO_M3: 'microgramsPerCubicMetres',\r\n            PC: 'percentage',\r\n            RATIO: 'ratio',\r\n            USD: 'usDollar',\r\n            YR: 'years'\r\n        };*/\r\n\r\n        viewData = $.extend(true, str, countryData, {\r\n            // id: cid\r\n            flag: {\r\n                src: 'images/flags/' + countryData.codes.ISO3.toLowerCase() + '.svg'\r\n            }\r\n        });\r\n\r\n        // console.info('viewData: ' + JSON.stringify(viewData));\r\n        $.get('templates/partials/countryDetails.hbs', function (source) {\r\n            var template = Handlebars.compile(source);\r\n\r\n            $('#country_details')\r\n                .find('.modal-dialog')\r\n                .html(template(viewData));\r\n                /*.end()\r\n                .removeClass(function (index, css) {\r\n                    return (css.match (/(^|\\s)background-\\S+/g) || []).join(' ');\r\n                })\r\n                .addClass('background-image background-' + cid + '-v');*/\r\n                //.replaceWith(template(viewData));\r\n\r\n\r\n\r\n            // Initialize jQuery plugins in this freshly generated block\r\n            appModule.initBlock('#country_details');\r\n\r\n            // Center map on selected country\r\n            $.when(appModule.deferred.ready.map).done(function () {\r\n    \r\n                $('#center_country').on('click', function (e) {\r\n                    e.preventDefault();\r\n                    var zoom = 2;\r\n                    if (countryData['Area(in sq km)']) {\r\n                        zoom = (4 - ~~countryData['Area(in sq km)'] / (17100000 / 4)).toFixed();\r\n                    }\r\n                    if (countryData.longitude && countryData.latitude) {\r\n                        //centerMap(~~countryData.longitude, ~~countryData.latitude, zoom);\r\n                        mapModule.fitCountry(countryData.codes.ISO3);\r\n                    }\r\n                    // console.log('Center map at longitude: ' + countryData.longitude + ' latitude: ' + countryData.latitude + ' zoom: ' + zoom);\r\n                });\r\n            });\r\n\r\n            // Select the BLI table column to display\r\n            var $table = $('.bli-table');\r\n            var $select = $('#bli_visible_column');\r\n            if ($table && $select) {\r\n                $select.on('change', function () {\r\n                    $select.find('option').each(function () { // :not(option[' + $select.val() + '])\r\n                        $table.find('tr :nth-child(' + $(this).val() + ')').hide(); // tr :not(:nth-child(' + $(this).val() + '))\r\n                    });\r\n                    $table.find('tr :nth-child(' + $select.val() + ')').show();\r\n                }).trigger('change');\r\n            }\r\n\r\n            // $('#modal_container').html(rendered);\r\n            // $('#country_details').modal('show');\r\n            // $('#country_details').find('[data-i18n]').localize();\r\n\r\n            /*$('#country_details').on('shown.bs.modal', function (event) {\r\n              // var button = $(event.relatedTarget),\r\n              //  id = button.data('id');\r\n              var id = $(this).find('[data-id]').first().attr('data-id').toLowerCase();\r\n              console.log('#country_details modal opened cibling country ' + id);\r\n              // showCountryDetails(id);\r\n              $(this).find('.modal-content').removeClass('background-*').addClass('background-image background-' + id);\r\n            });*/\r\n\r\n        });\r\n\r\n    }\r\n\r\n    \r\n    \r\n    $(function () {\r\n        \r\n        // Build country details when Bootstrap modal show up from a link click\r\n        $('#country_details').on('shown.bs.modal', function (event) {\r\n            var $button = $(event.relatedTarget),\r\n                id = $button.data('id');\r\n            if (id) {\r\n                console.log('#country_details modal opened cibling country ' + id);\r\n                countryDetailsModule.showCountryDetails(id);\r\n            }\r\n        });\r\n        \r\n    });\r\n    \r\n    \r\n    \r\n    return {\r\n        showCountryDetails: showCountryDetails\r\n    };\r\n\r\n})();\r\n\r\n"]}