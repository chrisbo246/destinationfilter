"use strict";function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}if(Handlebars.registerHelper("t",function(e){var t=i18nextInstance.t(e);return new Handlebars.SafeString(t)}),Handlebars.registerHelper("tr",function(e,t){var o=i18n.functions.extend(t.hash,e);t.fn&&(o.defaultValue=t.fn(e));var i=i18nextInstance.t(o.key,o);return new Handlebars.SafeString(i)}),Handlebars.registerHelper("math",function(e,t,o){return e=~~e,o=~~o,{"+":e+o,"-":e-o,"*":e*o,"/":e/o,"%":e%o}[t]}),Handlebars.registerHelper("if-lt",function(e,t){var o=arguments[arguments.length-1];return t>e?o.fn(this):o.inverse(this)}),Handlebars.registerHelper("if-gt",function(e,t){var o=arguments[arguments.length-1];return e>t?o.fn(this):o.inverse(this)}),"undefined"==typeof $.urlParam&&($.urlParam=function(e){var t=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return null===t?null:t[1]||0}),"undefined"==typeof String.prototype.toUpperCaseFirst&&(String.prototype.toUpperCaseFirst=function(){return this.charAt(0).toUpperCase()+this.slice(1).toLowerCase()}),"undefined"==typeof toCamel)var toCamel=function(){return this.toLowerCase().replace(/[^a-zA-Z0-9]([a-zA-Z0-9])?/g,function(e){return e[1]?e[1].toUpperCase():""})};if("undefined"==typeof String.prototype.toCamel&&(String.prototype.toCamel=function(e){return this.toLowerCase().replace(/[^a-zA-Z0-9]([a-zA-Z0-9])?/g,function(e){return e[1]?e[1].toUpperCase():""})}),"undefined"==typeof Array.prototype.max&&(Array.prototype.max=function(e){return Math.max.apply(Math,e)}),"undefined"==typeof Array.prototype.min&&(Array.prototype.min=function(e){return Math.min.apply(Math,e)}),"undefined"==typeof degToRad)var degToRad=function(e){return e*Math.PI*2/360};if("undefined"==typeof Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180}),"undefined"==typeof radToDeg)var radToDeg=function(e){return 360*e/(2*Math.PI)};if("undefined"==typeof Number.prototype.toDeg&&(Number.prototype.toDeg=function(){return 360*this/(2*Math.PI)}),"undefined"==typeof mod)var mod=function(e){return(e%(2*Math.PI)+2*Math.PI)%(2*Math.PI)};if("undefined"==typeof Number.prototype.mod&&(Number.prototype.mod=function(){return(this%(2*Math.PI)+2*Math.PI)%(2*Math.PI)}),"undefined"==typeof formatBytes)var formatBytes=function(e,t){if(0===e)return"0 Byte";var o=1e3,i=t+1||3,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(e)/Math.log(o));return(e/Math.pow(o,n)).toPrecision(i)+" "+r[n]};if("undefined"==typeof getAllEvents)var getAllEvents=function(e){var t=[];for(var o in e)0===o.indexOf("on")&&t.push(o.slice(2));return t.join(" ")};var i18nModule=function(){var e,t={i18next:{whitelist:["en","fr"],ns:["global","fields","values","sections","buttons","alerts","priorities","questions"],fallbackLng:"en",fallbackNS:"global",defaultNs:"global",detection:{lookupQuerystring:"lng"},backend:{loadPath:"locales/{{lng}}/{{ns}}.json",addPath:"locales/add/{{lng}}/{{ns}}",crossDomain:!1},cache:{}},jqueryI18next:{}},o=new $.Deferred;return console.time("i18next plugin initialization"),e=i18next.createInstance(),e.use(i18nextXHRBackend).use(i18nextBrowserLanguageDetector).init(t.i18next,function(){i18nextJquery.init(e,$,t.i18nextJquery),$(function(){$(document).attr("title",e.t("app.title")),$(document).attr("description",e.t("app.description"))}),console.timeEnd("i18next plugin initialization"),o.resolve()}),{deferred:o,i18next:e}}(),commonsModule=function(){var e,t,o,i=(e={debug:!1,disabledLogs:["log","time","timeEnd"],hideHash:!0,selector:{userLanguage:"#user_language, #language, #lang"},adsense:{containers:".adsbygoogle",adClient:"ca-pub-8495719252049968",adSlot:"3723415549",adFormat:"auto"},basil:{},chosen:{width:"100%",html_template:'<img class="{class_name}" src="{url}">'},garlic:{fieldsSelector:".garlic-auto-save",formsSelector:'[data-persist="garlic"]'},imagePicker:{},parsley:{fieldsSelector:"[data-parsley-id]",formsSelector:"[data-parsley-validate]"},webFontLoader:{version:"1.6.16",config:{google:{families:["Material+Icons"]}}},materialDesign:{iconsSelector:".material-icons"},parallax:{selector:'[data-type="background"]'},scrollTo:{toggleSelector:".scroll"},mixitup:{selector:"#disabled_priorities, #faq_list"},i18next:{instance:null},input:{events:"input change click"}},_defineProperty(e,"chosen",{events:"chosen:updated chosen:maxselected"}),_defineProperty(e,"bootstrapSwitch",{events:" switchChange.bootstrapSwitch"}),_defineProperty(e,"sortable",{events:"sortactivate sortbeforeStop sortchange sortcreate sortdeactivate sortout sortover sortreceive sortremove sort sortstart sortstop sortupdate"}),_defineProperty(e,"dataReset",{formsSelector:"form",toggleSelector:".delete_data"}),_defineProperty(e,"inputReset",{formsSelector:"form",toggleSelector:".reset_inputs",defaultAttribut:"default-value"}),_defineProperty(e,"spinner",{selector:".spinner"}),_defineProperty(e,"swal",{resetData:{title:"Reset everything",text:"This will erase your roadbook, reset settings and delete all local data stored by this application.",type:"warning",confirmButtonText:"Yes reset",cancelButtonText:"No stop !",showCancelButton:!0,closeOnConfirm:!1},inputReset:{title:"Done",text:"All inputs have been reset to their default values.",type:"success",timer:3e3,showConfirmButton:!1}}),e),r=i,n="https:"===window.location.protocol?"https:":"http:";"undefined"!=typeof Spinner&&(o=new Spinner(r.spinner));var a=function(e){e=e||"body";var t,o=$(e).find(r.adsense.containers).filter(":not([data-adsbygoogle-status])");console.log(o.length+" uninitialized ad(s) found in "+e),o.each(function(e,o){t=$(o),0===t.parents(":not(:visible)").length?(t.attr("data-ad-client")||t.attr("data-ad-client",r.adsense.adClient),t.attr("data-ad-slot")||t.attr("data-ad-slot",r.adsense.adSlot),t.attr("data-ad-format")||t.attr("data-ad-format",r.adsense.adFormat),console.log("Adsense attributs added to","#"+t.attr("id")),(adsbygoogle=window.adsbygoogle||[]).push({}),console.log("#"+t.attr("id")+" ad initialised with attributs ",t.data())):console.log("#"+t.attr("id")+" ad is in a hidden container and cannot be initialized now")})},s=function(){$.getScript(n+"//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",function(){console.log("Google Adsense library loaded"),$("html").addClass("adsbygoogle-status-done")})},l=function(){$(function(){var e=$(window);$(r.parallax.selector).each(function(){var t=$(this);e.scroll(function(){var o=-(e.scrollTop()/t.data("speed")),i="50% "+o+"px";t.css({backgroundPosition:i})})})})},c=function(e){$.extend(!0,r.scrollTo,e),$(function(){$(r.scrollTo.toggleSelector).click(function(){return $.scrollTo(this.hash,1500,{easing:"swing"}),!1})})},u=function(){if(document.cookie){var e=document.cookie.split(";");e.forEach(function(e){document.cookie=e.split("=")[0]+"=; username=; expires=Thu, 01 Jan 1970 00:00:00 UTC"})}localStorage&&localStorage.clear(),$().garlic&&$(r.garlic.fieldsSelector).garlic("destroy"),t&&t.reset()},d=function(e){var t,o=$(e);return o&&(t=o.attr("type"),t&&"undefined"!==t||(t=o.prop("tagName").toLowerCase())),t},g=function(e){var t,o=$(e);if(o){var i=d(o);-1!==$.inArray(i,["radio","checkbox"])?(t=o.prop("checked"),t&&o.attr("value")&&(t=o.attr("value"))):t="file"===i?o.prop("files"):-1!==$.inArray(i,["text","password","select","textarea","hidden","color","date","datetime","datetime-local","email","month","number","range","search","tel","time","url","week"])?o.val():o.html()}return t},p=function(e,t,o){var i=$(e);if(i){var r=d(i);$.isArray(t)&&"textarea"!==r&&(t=t[0]||null),-1!==$.inArray(r,["radio","checkbox"])?i.prop("checked",t):"file"===r?"FileList"===$.type(t)&&i.attr("files",t):"textarea"===r?($.isArray(t)&&(t=t.join("\n")),i.val(t)):-1!==$.inArray(r,["text","password","select","hidden","color","date","datetime","datetime-local","email","month","number","range","search","tel","time","url","week"])?i.val(t):i.html(t),o!==!1&&i.trigger("change")}},m=function(){if(!t){if("function"!=typeof Basil)return!1;t=new window.Basil(r.basil)}var e,o,i,n;$(r.garlic.formsSelector).each(function(){e=$(this),e.find(":input").not(':button, [type="submit"], [type="reset"]').filter("[id]").each(function(){o=$(this),n=o.attr("id"),i=t.get(n),null!==i&&(p(o,i,!1),console.log("#"+n+" value restored",i)),o.on("change",function(e){var o=e.target;i=g(o),n=o.id,t.set(n,i),console.log("#"+n+" value stored",i)})})})},f=function(e){if(!r.inputReset.defaultAttribut)return!1;e||(e=r.dataReset.formsSelector);var t,o;$(e).find(":input").not(':file, :button, [type="submit"], [type="reset"]').each(function(){t=$(this),o=g(this),t.attr("data-"+r.inputReset.defaultAttribut,o)})},h=function(e){var o,i,n;return r.inputReset.defaultAttribut?(e||(e=r.inputReset.formsSelector),void $(e).find(":input").filter("[data-"+r.inputReset.defaultAttribut+"]").each(function(){o=$(this),i=o.attr("id"),n=o.data(r.inputReset.defaultAttribut),i&&(t&&t.remove(i),p(this,n))})):!1},y=function(){$(r.dataReset.toggleSelector).click(function(){swal?swal(r.swal.resetData,function(e){e&&(u(),location.reload())}):(u(),location.reload())})},v=function(){$(r.inputReset.toggleSelector).click(function(){h(),swal&&swal(r.swal.inputReset)})},b=function(e){if($.extend(!0,r.googleFonts,e),!window.WebFontConfig){if(!r.webFontLoader.config)return console.warn("Global variable WebFontConfig is not defined"),!1;window.WebFontConfig={},$.extend(!0,window.WebFontConfig,r.webFontLoader.config)}!function(e){var t=e.createElement("script"),o=e.scripts[0];t.src="https://ajax.googleapis.com/ajax/libs/webfont/"+r.webFontLoader.version+"/webfont.js",o.parentNode.insertBefore(t,o)}(document)},w=function(){console.log=function(){},console.time=function(){},console.timeEnd=function(){},r.disabledLogs.forEach(function(e){console[e]=function(){}})},P=function(){if(!r.debug)return w(),$(".debug-only").hide(),!1;if($(".debug-only").show(),console.log("Debug",r.debug),r.input.events){var e=r.input.events;$().chosen&&(e+=r.chosen.events),$().bootstrapSwitch&&(e+=r.bootstrapSwitch.events),$(":input").on(e,function(e){var t=[];t.push('"'+e.type+'" event fired on "'+e.target.tagName+'" element'),e.target.type&&t.push('[type="'+e.target.type+'"]'),e.target.id&&t.push('[id="'+e.target.id+'"]'),e.target.name&&t.push('[name="'+e.target.name+'"]'),"input"!==e.type&&"change"!==e.type||(t.push('value="'+e.target.value+'"'),"checkbox"!==e.target.type&&"radio"!==e.target.type||t.push('checked="'+e.target.checked+'"')),console.log(t.join(" "),e)})}console.time("jQuery is ready"),console.time("HTML is loaded and DOM is ready"),console.time("Images, frames and objects are loaded"),$(function(){console.timeEnd("jQuery is ready")}),$(document).ready(function(){console.timeEnd("HTML is loaded and DOM is ready")}),$(window).on("load",function(){console.timeEnd("Images, frames and objects are loaded")}),console.log("window",window),console.log("document",document),console.log("document.domain",document.domain),console.log("document.URL",document.URL),console.log("location",location),console.log("navigator",navigator),$().sortable&&r.sortable.events&&$(".ui-sortable").on(r.sortable.events,function(e){console.log("#"+$(this).attr("id")+" event "+e.type+"("+$(this).sortable("toArray").length+")")}),$().mixitup&&r.mixitup.selector&&$(r.mixitup.selector).on("mixLoad mixStart mixEnd mixFail mixBusy",function(e,t){console.log("mixItUp "+e.type+": "+t.totalShow+" elements match the current filter")}),$().garlic&&r.garlic.fieldsSelector&&$(r.garlic.selector).garlic({onRetrieve:function(e,t){console.log("Garlic retrieved for "+(e.attr("id")?'id="#'+e.attr("id")+'"':"")+" "+(e.attr("name")?'name="#'+e.attr("name")+'"':""),t)},onPersist:function(e,t){console.log("Garlic persisted value for "+(e.attr("id")?'id="#'+e.attr("id")+'"':"")+" "+(e.attr("name")?'name="#'+e.attr("name")+'"':""),t)}}),$().parsley&&$.each(["form:init","form:validate","form:success","form:error","form:validated","form:submit","field:init","field:validate","field:success","field:error","field:validated"],function(e,t){window.Parsley.on(t,function(){console.log("Parsley "+t,"#"+this.$element.attr("id"))})}),"function"==typeof i18next&&r.i18next.instance&&(r.i18next.instance.useLocalStorage=!1,r.i18next.instance.localStorageExpirationTime=0,r.i18next.instance.on("initialized",function(){console.log("i18next initialized")}).on("loaded",function(){console.log("i18next loaded")}).on("failedLoading",function(e,t,o){console.warn("i18next failed loading: "+o+" language: "+e+" ns: "+t)}))},M=function(e,t,o){if(!(window.File&&window.FileReader&&window.FileList&&window.Blob))return!1;var i=new $.Deferred,r=0;return o=$.extend(!0,{},{format:"text",encoding:"UTF-8",cancelSelector:null},o),$.each(e,function(n,a){var s=new FileReader;"buffer"===o.format?s.readAsArrayBuffer(a,o.encoding):"binary"===o.format?s.readAsBinaryString(a,o.encoding):"data"===o.format?s.readAsDataURL(a,o.encoding):s.readAsText(a,o.encoding),s.onload=function(e){console.log("File load",e),t(e.target.result)},s.onloadstart=function(){},s.onloadend=function(){console.log(n+1+"/"+e.length+" file loaded"),r+=1,r===e.length&&(console.log("Last file loaded"),i.resolve())},s.onerror=function(){swal({title:"Oups!",text:"An error occured while trying to read your file.",type:"warning"})},o.cancelSelector&&$(o.cancelSelector).on("click",function(){s.abort()})}),i},S=function(){window.File&&window.FileReader&&window.FileList&&window.Blob||($('input[type="file"]').addClass("disabled"),console.warn("The File APIs are not fully supported by your browser."))},_=function(e){var t=$(e||"body");t&&t.on("click",'a[href^="#"]',function(){window.location.hash=""})},x=function(e,t,o){var i=[];return o.forEach(function(o){t[o]?e instanceof t[o]&&i.push(o):console.log(o+" is not defined")}),i},C=function(e){var t=e||navigator.language||navigator.userLanguage||navigator.languages[0]||"en";console.log("User language defined",t),$(r.selector.userLanguage).each(function(){$(this).val(t).trigger("change")})},L=function(e){r=$.extend(!0,{},i,e),r.debug&&P(),r.webFontLoader&&b(),$(function(){C(),r.inputReset&&(f(),v()),"function"==typeof Basil&&r.basil&&m(),r.dataReset&&y(),r.hideHash&&_(),S(),r.scrollTo&&c(),r.parallax&&l(),r.adsense&&s()})},T=function(e,t){if("undefined"==typeof Handlebars)return console.warn("Handlebars is not defined"),r.fail(),r;var o,i,r=new $.Deferred;return $.when($.ajax(e,function(e){o=Handlebars.compile(e)}),$.getJSON(t,function(e){i=e})).done(function(){r.resolve(o)}).fail(function(){r.fail()})},k=function(e){var t=$(e||"body");return t?(t.find("select").filter(".sort, .sort-asc").each(function(){var e=$(this),t=e.find("option");t.sort(function(e,t){return $(e).text()>$(t).text()}),e.html("").append(t)}),"undefined"!=typeof t.localize&&t.localize(),"undefined"!=typeof ScrollReveal&&(window.sr=new ScrollReveal(options.scrollReveal)),$().chosen&&(t.find(".chosen-select").each(function(){$(this).attr("data-placeholder",$(this).attr("placeholder"))}),t.find(".chosen-select").chosen(r.chosen)),$().imagepicker&&t.find(".image-picker").imagepicker(r.imagePicker),void("undefined"!=typeof bootstrapModule&&bootstrapModule.initBlock(e))):!1};return{hideHashOnClick:_,storeInputChanges:m,basil:t,getInputType:d,getInputValue:g,getInstancesOf:x,hideLogs:w,init:L,insertAdsenseAds:a,reader:M,resetInputValues:h,setInputValue:p,setUserLanguage:C,watchInputResetButton:v,getCompiledTemplate:T,initBlock:k}}(),bootstrapModule=function(){var e,t={debug:!1,useHash:!0,showHash:!1,basil:{namespace:"bootstrap"},modal:{modalSelector:".modal",toggleSelector:'[data-toggle="modal"]'},tab:{toggleSelector:'[data-toggle="tab"]',storeActive:!0},tooltip:{toggleSelector:'[data-toggle="tooltip"]',options:{}},popover:{toggleSelector:'[data-toggle="popover"]',options:{}},switchButton:{togglerSelector:".btn-switch"}},o=t;"undefined"!=typeof Basil&&(e=new window.Basil(o.basil));var i=function(){if("undefined"==typeof $.fn.tab)return console.warn("Bootstrap tab plugin is not loaded"),!1;var t,i=$(o.tab.toggleSelector),r="activeTab";if(i){if(o.useHash&&location.hash&&$(location.hash)&&i.filter('[href="'+location.hash+'"]').length>0?(t=location.hash,console.log("URL hash detected",t)):e&&(t=e.get(r),console.log("Hash restored",t)),t){var n=i.filter('[href="'+t+'"]').first();n.tab("show"),e&&e.set(r,t),console.log("Last active tab restored",t)}i.on("shown.bs.tab",function(i){t=i.target.hash,t&&(o.showHash?(location.hash=t,console.log("Active tab hash added to URL",t)):e&&(e.set(r,t),console.log("Active tab stored",t)))})}},r=function(){if(!$().tab)return!1;var e=$(o.tab.toggleSelector);e&&e.on("click",function(){$(".dropdown-menu").find(".active").removeClass("active")})},n=function(){if("undefined"==typeof $.fn.modal)return console.warn("Bootstrap modal plugin is not loaded"),!1;var t=$(o.modal.modalSelector),i="activeModal",r=e.get(i);if(t){if(o.useHash&&location.hash&&$(location.hash)&&t.filter(location.hash).length>0?(r=location.hash,console.log("URL hash detected",r)):e&&(r=e.get(i),console.log("Hash restored",r)),r){var n=$(r);n.modal("show"),e&&e.set(i,r),console.log("Last active modal restored",r)}t.on("shown.bs.modal",function(t){r="#"+t.target.id,e&&r&&(e.set(i,r),console.log("Active modal stored",r))}),t.on("hidden.bs.modal",function(){e&&(e.set(i,null),console.log("Active modal stored",null))})}},a=function(){return $().modal?void $(o.modal.modalSelector).on("show.bs.modal",function(e){var t,o=$(this),i=$(e.relatedTarget),r=i.data();if(r){if(r.filter){var n=o.find("section");console.log("Modal section filter",r.filter);var a;n&&n.each(function(){a=$(this),a.is(r.filter)?a.show():a.hide()})}r.title&&(t=o.find(".modal-title").first(),t&&t.text(r.title)),r.ok&&(t=o.find(".modal-footer .btn-primary").first(),t&&t.text(r.ok)),r.ok&&(t=o.find('.modal-footer [data-dismiss="modal"]').first(),t&&t.text(r.ok))}}):!1},s=function(e){if(!e)return!1;var t=[];return $.each(e,function(e,o){t.push('<li class="list-group-item">'+escape(o.name)+' <span class="badge">'+formatBytes(o.size)+(" "+o.type||"")+"<span></li>")}),'<ul class="list-group">'+t.join("")+"</ul>"},l=function(e,t){var i=$(e);return i?void i.find(o.tab.toggleSelector).one("shown.bs.tab",function(e){var o=$(e.target).attr("href");t(o)}):!1},c=function(){var e;$('input[type="range"]').each(function(){e=$(this),e.attr("data-original-title",e.val()),e.on("input",function(e){$(this).attr("data-original-title",e.target.value).tooltip("show")}),e.on("focus",function(){$(this).tooltip("show")})})},u=function(){$().tooltip&&$(o.tooltip.toggleSelector).tooltip(o.tooltip.options)},d=function(){if(!o.debug)return commonsModule.hideLogs(),!1;if(console.log("Bootstrap debug started"),$().tab){console.log("Tab plugin loaded");var e=$(o.tab.toggleSelector);console.log(e.length+" tab(s) found"),e.on("shown.bs.tab hidden.bs.tab",function(e){console.log(e.target.href+" tab "+e.type,e)})}if($().modal){console.log("Modal plugin loaded");var t=$(o.modal.modalSelector);console.log(t.length+" modal(s) found"),t.on("shown.bs.modal hidden.bs.modal",function(e){console.log("#"+e.target.id+" modal "+e.type,e)})}},g=function(){if($().tab){var e=$(o.tab.toggleSelector);e.on("shown.bs.tab",function(){commonsModule.hideHash()})}if($().modal){var t=$(o.modal.modalSelector);t.on("shown.bs.modal",function(){commonsModule.hideHash()})}},p=function(){$(o.switchButton.togglerSelector).click(function(){var e=$(this);$(this).parents(".btn-group").find(o.switchButton.togglerSelector).filter(".active").removeClass("active"),e.toggleClass("active")})},m=function(){if(!e)return!1;var t,i,r,n;$(o.switchButton.togglerSelector).filter("[id]").each(function(){t=$(this),t.on("click",function(){i=$(this).parents(".btn-group").find(o.switchButton.togglerSelector).filter("[id]"),i.length||(i=$(this)),i.each(function(){t=$(this),r=t.hasClass("active"),n=t.attr("id"),e.set(n,r),console.log("#"+n+" button state stored",r)})}),n=t.attr("id"),r=e.get(n),null!==r&&(r?t.trigger("click"):t.removeClass("active"),console.log("#"+n+" button click fired",r))})},f=function(e){var t=$(e);return t?($().popover&&o.popover&&t.find(o.popover.toggleSelector).popover(o.popover.options),$().tooltip&&o.tooltip&&t.find(o.tooltip.toggleSelector).tooltip(o.tooltip.options),void($().bootstrapSwitch&&t.find(".switch").bootstrapSwitch())):!1},h=function(e){o=$.extend(!0,{},t,e),d(),$(function(){o.useHash,$().tooltip&&o.tooltip&&(u(),c()),$().tab&&o.tab&&(r(),o.tab.storeActive&&i()),$().modal&&o.modal&&a(),$().button&&o.switchButton&&(p(),"function"==typeof Basil&&o.basil&&m())})};return{buildFileList:s,hideHashOnShown:g,init:h,oneShownHiddenTab:l,rangeValueTooltip:c,restoreActiveModal:n,settings:o,initBlock:f}}(),dataModule=function(){var e,t,o,i,r=new $.Deferred,n={},a={LIC:"1045",LMC:"4125",UMC:"12746",OEC:"25000",NOC:"25000"};return console.time("currencies.json loaded"),console.time("countries.json loaded"),console.time("disabledPrioritiesModal.json loaded"),console.time("languages.json loaded"),$.when($.getJSON("data/currencies.json",function(e){t=e,console.timeEnd("currencies.json loaded"),console.log("currencies",t)}),$.getJSON("data/countries.json",function(t){e=t,console.timeEnd("countries.json loaded"),console.log("countries",e),$.each(t,function(e,t){t.ISO&&t.shapeId&&(n[t.shapeId]=e)}),console.log("countryCodesISO2",n)}),$.getJSON("data/priorities.json",function(e){o=e,console.timeEnd("priorities.json loaded"),console.log("priorities",o)}),$.getJSON("data/languages.json",function(e){i=e,console.timeEnd("languages.json loaded"),console.log("languages",i)})).done(function(){console.log("Data loaded"),r.resolve()}),{deferred:r,countries:e,currencies:t,priorities:o,languages:i,oecdIncomeLevels:a,countryCodesISO2:n}}(),scoreModule=function(){var e=function(){console.time("updateScores function executed");var e,t,o,i,r,n,a,s,l,c,u,d={},g={};return $("#user_profile_form").find(":input").filter("[id]").each(function(){e=$(this);var t=e.attr("id").toCamel();g[t]=e.val()}),$.when(dataModule.languages).done(function(){$.isArray(g.userReadingLanguages)&&dataModule.languages&&(g.userReadingScripts=[],$.each(g.userReadingLanguages,function(e,t){$.isPlainObject(dataModule.languages[t])&&dataModule.languages[t].ScriptCode&&g.userReadingScripts.push(dataModule.languages[t].ScriptCode)}))}),$.isArray(g.userCurrencies)&&$.each(g.userCurrencies,function(e,t){dataModule.currencies[t]&&dataModule.currencies[t].eurExchangeRate&&(!g.userChangeRate||dataModule.currencies[t].eurExchangeRate<g.userChangeRate)&&(g.userChangeRate=parseFloat(dataModule.currencies[t].eurExchangeRate))}),console.log("User profile: "+JSON.stringify(g)),$.when(dataModule.countries,dataModule.currencies).done(function(){$.each(dataModule.countries,function(e,t){t.matchingPriorities={},t.points=0,t.missingDataPoints=0,t.percent=0,t.matchingPriorities.currencyPriority={},t.matchingPriorities.currencyPriority.required=[],g.userCurrencies?(t.matchingPriorities.currencyPriority.values=[],t.CurrencyCode?(i=$.intersect(g.userCurrencies,[t.CurrencyCode]).length,i>0&&t.matchingPriorities.currencyPriority.values.push(1)):t.matchingPriorities.currencyPriority.missing=!0):t.matchingPriorities.currencyPriority.required.push("user_currencies"),t.matchingPriorities.neighborPriority={},t.matchingPriorities.neighborPriority.required=[],t.matchingPriorities.neighborPriority.values=[],g.userCountry?t.neighbours?-1===$.inArray(g.userCountry,t.neighbours)&&t.ISO!==g.userCountry||t.matchingPriorities.neighborPriority.values.push(1):t.matchingPriorities.neighborPriority.missing=!0:t.matchingPriorities.neighborPriority.required.push("user_country"),t.matchingPriorities.speakingLanguagePriority={},t.matchingPriorities.speakingLanguagePriority.required=[],t.matchingPriorities.speakingLanguagePriority.values=[],g.userSpeakingLanguages?t.languagePopulation?$.each(t.languagePopulation,function(e,o){i=$.intersect(g.userSpeakingLanguages,[o.type]).length,i>0?t.matchingPriorities.speakingLanguagePriority.values.push(o.populationPercent):t.matchingPriorities.speakingLanguagePriority.values.push(0)}):t.matchingPriorities.speakingLanguagePriority.missing=!0:t.matchingPriorities.speakingLanguagePriority.required.push("user_speaking_languages"),t.matchingPriorities.readingLanguagePriority={},t.matchingPriorities.readingLanguagePriority.required=[],t.matchingPriorities.readingLanguagePriority.values=[],g.userReadingScripts?t.languagePopulation?$.each(t.languagePopulation,function(e,o){o.officialStatus&&(i=$.intersect(g.userReadingScripts,[o.ScriptCode]).length,i>0&&-1!==$.inArray(o.officialStatus,["official","de_facto_official","official_regional"])&&t.matchingPriorities.readingLanguagePriority.values.push(1))}):t.matchingPriorities.readingLanguagePriority.missing=!0:t.matchingPriorities.readingLanguagePriority.required.push("userReadingScripts"),t.matchingPriorities.visaFreePriority={},t.matchingPriorities.voaFeePriority={},t.matchingPriorities.onwardTicketPriority={},t.matchingPriorities.visaFreePriority.values=[],t.matchingPriorities.voaFeePriority.values=[],t.matchingPriorities.onwardTicketPriority.values=[],t.matchingPriorities.visaFreePriority.required=[],t.matchingPriorities.voaFeePriority.required=[],t.matchingPriorities.onwardTicketPriority.required=[],g.userCitizenships?(t.ISO&&-1!==$.inArray(t.ISO,g.userCitizenships)&&(t.matchingPriorities.visaFreePriority.values.push(300),t.matchingPriorities.voaFeePriority.values.push(1),t.matchingPriorities.onwardTicketPriority.values.push(1)),t.touristVisas?$.each(t.touristVisas,function(e,o){-1!==$.inArray(o.originCountryISO,g.userCitizenships)&&((o.visaFreeLimit||0===o.visaFreeLimit)&&(o.visaFreeLimit>0?t.matchingPriorities.visaFreePriority.values.push(o.visaFreeLimit):"unlimited"===o.visaFreeLimit&&t.matchingPriorities.visaFreePriority.values.push(300)),o["voa-fee"]?t.matchingPriorities.voaFeePriority.missing=!0:t.matchingPriorities.voaFeePriority.values.push(1),o.requirements&&-1!==$.inArray("onward-ticket",o.requirements)?t.matchingPriorities.onwardTicketPriority.missing=!0:t.matchingPriorities.onwardTicketPriority.values.push(1))}):(t.matchingPriorities.visaFreePriority.missing=!0,t.matchingPriorities.voaFeePriority.missing=!0,t.matchingPriorities.onwardTicketPriority.missing=!0)):(t.matchingPriorities.visaFreePriority.required=["user_citizenships"],t.matchingPriorities.voaFeePriority.required=["user_citizenships"],t.matchingPriorities.onwardTicketPriority.required=["user_citizenships"]),t.matchingPriorities.acPlugsPriority={},t.matchingPriorities.acPlugsPriority.required=[],t.matchingPriorities.acPlugsPriority.values=[],g.userPlugTypes?t.plugs?$.each(t.plugs,function(e,o){o.plugType?(c=o.plugType,i=$.intersect(g.userPlugTypes,[c]).length,i>0&&t.matchingPriorities.acPlugsPriority.values.push(1)):t.matchingPriorities.acPlugsPriority.missing=!0}):t.matchingPriorities.acPlugsPriority.missing=!0:t.matchingPriorities.acPlugsPriority.required.push("user_plug_types"),t.matchingPriorities.acVoltagesPriority={},t.matchingPriorities.acFrequenciesPriority={},t.matchingPriorities.acVoltagesPriority.required=[],t.matchingPriorities.acFrequenciesPriority.required=[],t.matchingPriorities.acVoltagesPriority.values=[],t.matchingPriorities.acFrequenciesPriority.values=[],g.userPlugVoltages&&g.userPlugFrequencies?t.plugs?$.each(t.plugs,function(e,o){o.frequencies?(u=o.frequencies,i=$.intersect(g.userPlugFrequencies.map(Number),u).length,i>0?(t.matchingPriorities.acFrequenciesPriority.values.push(1),o.electricPotentials?$.each(g.userPlugVoltages.map(Number),function(e,i){$.each(o.electricPotentials,function(e,o){t.matchingPriorities.acVoltagesPriority.values.push(Math.abs(i-o))})}):t.matchingPriorities.acVoltagesPriority.missing=!0):t.matchingPriorities.acFrequenciesPriority.values.push(0)):t.matchingPriorities.acFrequenciesPriority.missing=!0}):(t.matchingPriorities.acVoltagesPriority.missing=!0,t.matchingPriorities.acFrequenciesPriority.missing=!0):t.matchingPriorities.acVoltagesPriority.required.push("user_plug_voltages"),t.matchingPriorities.democracyPriority={},t.matchingPriorities.democracyPriority.required=[],t.matchingPriorities.democracyPriority.values=[],t.democracy&&t.democracy.Score?t.matchingPriorities.democracyPriority.values.push(t.democracy.Score):t.matchingPriorities.democracyPriority.missing=!0,t.matchingPriorities.changeRatePriority={},t.matchingPriorities.changeRatePriority.required=[],t.matchingPriorities.changeRatePriority.values=[],g.userCurrencies&&g.userChangeRate?dataModule.currencies&&dataModule.currencies[t.currency.CurrencyCode]&&dataModule.currencies[t.currency.CurrencyCode].eurExchangeRate?(o=parseFloat(dataModule.currencies[t.currency.CurrencyCode].eurExchangeRate),o?(a=g.userChangeRate/o,t.matchingPriorities.changeRatePriority.values.push(Math.min(a,1))):t.matchingPriorities.changeRatePriority.required.push("userChangeRate")):t.matchingPriorities.changeRatePriority.missing=!0:t.matchingPriorities.changeRatePriority.required.push("user_currencies"),t.matchingPriorities.incomeLevelPriority={},t.matchingPriorities.incomeLevelPriority.required=[],t.matchingPriorities.incomeLevelPriority.values=[],g.userIncomeLevel?t.incomeLevel&&t.incomeLevel.id?(c=~~g.userIncomeLevel-~~dataModule.oecdIncomeLevels[t.incomeLevel.id],t.matchingPriorities.incomeLevelPriority.values.push(Math.max(c,0))):t.matchingPriorities.incomeLevelPriority.missing=!0:t.matchingPriorities.incomeLevelPriority.required.push("user_income_level"),t.matchingPriorities.drivingSidePriority={},t.matchingPriorities.drivingSidePriority.required=[],t.matchingPriorities.drivingSidePriority.values=[],g.userDrivingSides?t.drivingSide?(i=$.intersect(g.userDrivingSides,[t.drivingSide]).length,i>0&&t.matchingPriorities.drivingSidePriority.values.push(1)):t.matchingPriorities.drivingSidePriority.missing=!0:t.matchingPriorities.drivingSidePriority.required.push("user_driving_sides"),t.matchingPriorities.religionPriority={},t.matchingPriorities.religionPriority.required=[],t.matchingPriorities.religionPriority.values=[],g.userReligion?t.religions?$.each([g.userReligion],function(e,o){t.religions[o]&&t.matchingPriorities.religionPriority.values.push(~~t.religions[o].percent)}):t.matchingPriorities.religionPriority.missing=!0:t.matchingPriorities.religionPriority.required.push("user_religion"),t.matchingPriorities.islandPriority={},t.matchingPriorities.islandPriority.values=[],t.islands?t.matchingPriorities.islandPriority.values.push(1):t.matchingPriorities.islandPriority.missing=!0,$.when(dataModule.deferred).done(function(){$.each(dataModule.priorities,function(e,o){var i=o.bliIndicator,r=o.id;i&&r&&(t.matchingPriorities[r]={},t.matchingPriorities[r].values=[],t.betterLifeIndexes?$.each(t.betterLifeIndexes,function(e,o){o.INDICATOR===i&&"TOT"===o.INEQUALITY&&t.matchingPriorities[r].values.push(o.Value)}):t.matchingPriorities[r].missing=!0)})})}),$.when(dataModule.deferred).done(function(){t=$("#enabled_priorities").sortable("toArray"),r=t.length,r||(t=$("#disabled_priorities").sortable("toArray"));var e=0;$.each(t,function(o,i){d[i]={},$.each(dataModule.priorities,function(e,t){t.id===i&&($.extend(d[i],t),d[i].reverse=$("#"+i).find(".reverse-priority").prop("checked"))});var c=1,u=$("#priority_ratio");u&&u.val()&&(c=u.val()),r>0?d[i].points=(t.length-o)*c*100:d[i].points=100,console.info("enabledPriorities["+i+"].points="+d[i].points),e+=d[i].points,$.each(dataModule.countries,function(e,t){"acVoltagesPriority"===i&&"au"===e&&console.info("dataModule.countries["+e+"].matchingPriorities["+i+"]="+JSON.stringify(t.matchingPriorities[i])),t.matchingPriorities[i]&&$.isArray(t.matchingPriorities[i].values)&&t.matchingPriorities[i].values.length>0?("acVoltagesPriority"===i&&"au"===e&&console.info("Array.max("+JSON.stringify(t.matchingPriorities[i].values)+", "+d[i].maxValue+")"),l=Math.max.apply(Math,t.matchingPriorities[i].values.map(Number)),d[i].maxValue=d[i].maxValue||0===d[i].maxValue?Math.max(l,d[i].maxValue):l,"acVoltagesPriority"===i&&"au"===e&&console.info(e+": enabledPriorities["+i+"].maxValue="+d[i].maxValue),
"acVoltagesPriority"===i&&"au"===e&&console.info("Array.min("+JSON.stringify(t.matchingPriorities[i].values)+", "+d[i].minValue+")"),s=Math.min.apply(Math,t.matchingPriorities[i].values.map(Number)),d[i].minValue=d[i].minValue||0===d[i].minValue?Math.min(s,d[i].minValue):s,"acVoltagesPriority"===i&&"au"===e&&console.info(e+": enabledPriorities["+i+"].minValue="+d[i].minValue)):t.missingDataPoints=t.missingDataPoints+d[i].points}),"acVoltagesPriority"===i&&console.info("enabledPriorities["+i+"].points="+~~d[i].points+" enabledPriorities["+i+"].maxValue="+~~d[i].maxValue+" enabledPriorities["+i+"].minValue="+~~d[i].minValue),!d[i].points&&0!==d[i].points||!d[i].maxValue&&0!==d[i].maxValue||!d[i].minValue&&0!==d[i].minValue||(a=d[i].points/(d[i].maxValue-d[i].minValue||1),"acVoltagesPriority"===i&&console.info("enabledPriorities["+i+"].ratio="+a),$.each(dataModule.countries,function(e,t){t.matchingPriorities[i]&&t.matchingPriorities[i].values&&t.matchingPriorities[i].values.length>0&&(l=Math.max.apply(Math,t.matchingPriorities[i].values),n=(l-d[i].minValue)*a,"acVoltagesPriority"===i&&"au"===e&&console.info("max("+JSON.stringify(t.matchingPriorities[i].values)+") = "+l),"acVoltagesPriority"===i&&"au"===e&&console.info("points = ("+l+" - "+d[i].minValue+") * "+a+"="+n),d[i].reverse&&(n=d[i].points-n),t.matchingPriorities[i].points=n,t.matchingPriorities[i].percent=t.matchingPriorities[i].points/d[i].points*100,"acVoltagesPriority"===i&&"au"===e&&console.info("dataModule.countries["+e+"].matchingPriorities["+i+"].points="+t.matchingPriorities[i].points),"acVoltagesPriority"===i&&"au"===e&&console.info("dataModule.countries["+e+"].matchingPriorities["+i+"].percent="+t.matchingPriorities[i].percent),t.points=t.points+n,"acVoltagesPriority"===i&&"au"===e&&console.info("dataModule.countries["+e+"].points="+dataModule.countries[e].points))}))}),console.info("maxPoints="+e),$.each(dataModule.countries,function(t,o){o.percent=o.points/e*100,o.missingDataPercent=o.missingDataPoints/e*100,"au"===t&&console.info("dataModule.countries["+t+"].percent="+dataModule.countries[t].percent)})})}),console.timeEnd("updateScores function executed"),!0};return{updateScores:e}}(),homeModule=function(){var e=new $.Deferred,t=function(){var t=$("#lng");t.on("change",function(){t.closest("form").submit()}),$(".start-tour").on("click",function(e){e.preventDefault(),$(this).addClass("disabled"),tour.end(),tour.restart()}),$.when(i18nModule.deferred).done(function(){var e=$("#lng");e.val(i18nModule.i18next.language)}),e.resolve()},o=$('[data-anchor="home"]');return o.load("templates/homeView.htm",function(i,r,n){n.done(function(){e.notify("rendered"),commonsModule.initBlock(o),t()})}),{deferred:e}}(),countryListModule=function(){var e={resultLimit:100},t=new $.Deferred,o=function(){console.time("_drawCountryList function executed");var t,o,i,r,n={};$.when(dataModule.deferred).done(function(){console.log("dataModule.countries",dataModule.countries),t=[];var a=0;$.each(dataModule.countries,function(e,o){t.push({id:e,row:a,points:o.points}),a+=1}),t.sort(function(e,t){return t.points-e.points}),n.countries=[],$.each(t,function(t,a){(!e||!e.resultLimit||t<e.resultLimit)&&(o=dataModule.countries[a.id],console.log("dataModule.countries["+a.id+"]",o),i=$.extend(!0,{},o,{id:a.id,row:a.row}),o&&o.codes&&o.codes.ISO3&&(r=o.codes.ISO3.toLowerCase(),i.flag={src:"images/flags/"+r+".svg"}),o.percent>=0&&(i.percent=o.percent.toFixed()),o.matchingPriorities&&$.each(o.matchingPriorities,function(e,t){t.required&&t.required.length>0&&(i.warning=!0),t.missing&&(i.error=!0)}),n.countries.push(i))}),$.get("templates/countryListView.hbs",function(t){var o,i;i=Handlebars.compile(t),$('[data-anchor="country_list"]').html(i(n)),commonsModule.initBlock('[data-anchor="country_list"]'),o=$("#result_limit"),o&&o.on("change",function(){e.resultLimit=o.val()})}),console.timeEnd("_drawCountryList function executed")})},i=function(){$.when(dataModule.deferred,userProfileModule.deferred,enabledPrioritiesModule.deferred,disabledPrioritiesModule.deferred).done(function(){scoreModule.updateScores(),o(),$(".navbar").find('a[data-toggle="tab"]').on("shown.bs.tab",function(e){var t=$(e.target).attr("href");"#home_pane"===t&&(scoreModule.updateScores(),o())})}),t.resolve()};return commonsModule.getCompiledTemplate("templates/countryListView.hbs","data/countries.json").done(function(e){$(function(){var o=$('[data-anchor="country_list"]');o.html(e),t.notify("rendered"),commonsModule.initBlock(o),i()})}),{deferred:t}}(),countryDetailsModule=function(){var e=new $.Deferred,t=function(e){var t,o,i,r,n,a,s={};return e?(s.citizenships=[],console.info("touristVisas: "+JSON.stringify(e.touristVisas)+" #user_citizenships"+JSON.stringify($("#user_citizenships").val())),r=$("#user_citizenships").val(),e.touristVisas&&r&&(console.info("userCitizenships: "+JSON.stringify(r)),$.each(e.touristVisas,function(t,o){if(console.log("Is "+o.originCountryISO+" in "+JSON.stringify(r)),-1!==$.inArray(o.originCountryISO,r)){console.info("Is "+o.originCountryISO+" in "+JSON.stringify(r));var i,n=o.originCountryISO.toLowerCase();if(e.slugs&&e.slugs["visahq.com"]){var a="https://"+e.slugs["visahq.com"]+".visahq.com/requirements/";if(n&&dataModule.countries[n]&&dataModule.countries[n].slugs["visahq.com"]){i=a,dataModule.countries[n].slugs["visahq.com"]&&(i=i+dataModule.countries[n].slugs["visahq.com"]+"/");var l=$("#user_country").val().toLowerCase();l&&dataModule.countries[l].slugs["visahq.com"]&&(i=i+"resident-"+dataModule.countries[l].slugs["visahq.com"]+"/")}}s.citizenships.push($.extend(!0,{},o,{href:i}))}})),console.info("Citizenships: "+JSON.stringify(s.citizenships)),e.currency.CurrencyCode&&$("#user_currencies").val()&&(s.userCurrencies=[],$.each($("#user_currencies").val(),function(t,o){var i,r,n;dataModule.currencies&&dataModule.currencies[o]&&dataModule.currencies[o].eurExchangeRate>0?(i=dataModule.currencies[o].CcyNm,r=dataModule.currencies[o].eurExchangeRate):(i=dataModule.currencies.EUR.CcyNm,r=1),n=dataModule.currencies[e.currency.CurrencyCode],n&&"EUR"!==o&&s.userCurrencies.push({currencyValue:(1/(n.eurExchangeRate/r)).toFixed(2),currencyName:i,localCurrencyValue:(n.eurExchangeRate/r).toFixed(2),localCurrencyName:n.CcyNm,changeRateURL:"http://www.xe.com/fr/currencyconverter/convert/?Amount=1&From="+o+"&To="+e.currency.CurrencyCode})})),s.costOfLivingURL="http://www.numbeo.com/cost-of-living/",e.slugs&&(s.climatURL="http://www.weather-and-climate.com/average-monthly-Rainfall-Temperature-Sunshine-in-"+e.slugs["weather-and-climate.com"],s.embassiesURL="http://embassy.goabroad.com/embassies-in/"+e.slugs["goabroad.com"],userData&&userData.address&&userData.address.ISO?n=userData.address.ISO:$("#user_country").val()&&(n=$("#user_country").val()),n&&e.slugs["goabroad.com"]&&n.toLowerCase()!==e.ISO.toLowerCase()&&(s.localEmbassiesURL="http://embassy.goabroad.com/embassies-of-"+e.slugs["goabroad.com"],dataModule.countries[n.toLowerCase()]&&dataModule.countries[n.toLowerCase()].slugs["goabroad.com"]&&(s.localEmbassiesURL=s.localEmbassiesURL+"-in-"+dataModule.countries[n.toLowerCase()].slugs["goabroad.com"])),s.costOfLivingURL="http://www.numbeo.com/cost-of-living/country_result.jsp?country="+e.slugs["numbeo.com"],s.betterLifeIndexURL="http://www.oecdbetterlifeindex.org/countries/"+e.slug+"/"),e.points&&(s.fixedScore=e.points.toFixed()),s.matches=[],t=$("#enabled_priorities").sortable("toArray"),t.length||(t=$("#disabled_priorities").sortable("toArray")),$.each(t,function(t,o){i={id:o},e.matchingPriorities[o]&&(e.matchingPriorities[o].percent>=0&&(i.percent=e.matchingPriorities[o].percent.toFixed()),e.matchingPriorities[o].required&&e.matchingPriorities[o].required.length>0&&(i.warning=!0),e.matchingPriorities[o].missing&&(i.error=!0)),s.matches.push(i)}),e.betterLifeIndexes&&(o={},$.each(e.betterLifeIndexes,function(e,t){o[t.INDICATOR]||(o[t.INDICATOR]={}),o[t.INDICATOR][t.INEQUALITY]=$.extend({},t,{})}),s.bli=o),a=$.extend(!0,s,e,{flag:{src:"images/flags/"+e.codes.ISO3.toLowerCase()+".svg"}}),void $.get("templates/countryDetails.hbs",function(t){var o=Handlebars.compile(t);$("#country_details").find(".modal-dialog").html(o(a)),commonsModule.initBlock("#country_details"),$.when(mapModule.deferred).done(function(){$("#center_country").on("click",function(t){t.preventDefault(),e.longitude&&e.latitude&&mapModule.fitCountry(e.codes.ISO3)})});var i=$(".bli-table"),r=$("#bli_visible_column");i&&r&&r.on("change",function(){r.find("option").each(function(){i.find("tr :nth-child("+$(this).val()+")").hide()}),i.find("tr :nth-child("+r.val()+")").show()}).trigger("change")})):!1},o=function(e,o){return console.log("showCountryDetails("+e+", "+o+")"),e?void $.when(dataModule.countries,dataModule.currencies).done(function(){"ISO3"===o&&(e=countryCodesISO2[e],console.log("Country code converted to ISO2",e)),e=e.toLowerCase();var i=dataModule.countries[e];return i?void t(i):(console.warn("Missing dataModule.countries["+e+"]"),$("#country_details").modal("hide"),!1)}):!1};$(function(){$("#country_details").on("shown.bs.modal",function(e){var t=$(e.relatedTarget),o=t.data("id");o&&(console.log("#country_details modal opened cibling country "+o),countryDetailsModule.showCountryDetails(o))}),e.resolve()});var i=$('[data-anchor="country_details_modal"]');return i.load("templates/countryDetailsModal.htm",function(t,o,r){r.done(function(){e.notify("rendered"),commonsModule.initBlock(i)})}),{deferred:e,showCountryDetails:o}}(),enabledPrioritiesModule=function(){var e={sortable:{connectWith:"ul",cursor:"move",forcePlaceholderSize:!0,handle:":not(.disabled)",helper:"clone",items:"> li:not(.disabled)",opacity:.8,placeholder:"ui-sortable-placeholder",revert:!0,scroll:!0,tolerance:"pointer"},cookieExpires:30},t=new $.Deferred,o=function(){var o=$("#enabled_priorities");o.sortable(e.sortable).disableSelection().on("sortstop sortreceive sortremove",function(){var e=$(this).sortable("toArray");$("#stored_priorities").val(e.join(",")).trigger("change"),$.each(e,function(e,t){"speaking_language_priority"===t&&$("#user_speaking_languages").prop("required",!0),"reading_language_priority"===t&&$("#user_reading_languages").prop("required",!0),"visa_free_priority"===t&&$("#user_citizenships").prop("required",!0),"currency_priority"!==t&&"change_rate_priority"!==t||$("#user_currencies").prop("required",!0),"ac_plugs_priority"!==t&&"ac_voltages_priority"!==t||($("#user_plug_types").prop("required",!0),$("#user_plug_voltages").prop("required",!0)),"income_level_priority"===t&&$("#user_income_level").prop("required",!0)}),o.find("li.active:visible").length>0?$("#disable_selected_priorities").removeClass("disabled"):$("#disable_selected_priorities").addClass("disabled"),e.length>0?($("#disable_all_priorities").removeClass("disabled"),$("#no_priority_alert").hide(),appModule.validationStepPercent(1,100)):($("#disable_all_priorities").addClass("disabled"),$("#disable_selected_priorities").addClass("disabled"),$("#no_priority_alert").fadeIn(),appModule.validationStepPercent(1,0))}),$("#disable_selected_priorities").on("click",function(e){e.preventDefault();var t=[];$.each(o.find("li.active:visible"),function(){$(this).removeClass("active"),$(this).find(".glyphicon-remove").removeClass("glyphicon-remove").addClass("glyphicon-plus"),t.push($(this))}),$("#disabled_priorities").append(t).trigger("sortreceive"),o.trigger("sortremove"),$("#priority_filters").trigger("change")}),$("#disable_all_priorities").on("click",function(e){e.preventDefault();var t=[];$.each(o.find("li:visible"),function(){$(this).removeClass("active"),$(this).find(".glyphicon-remove").removeClass("glyphicon-remove").addClass("glyphicon-plus"),t.push($(this))}),$("#disabled_priorities").append(t).trigger("sortreceive"),o.trigger("sortremove"),$("#priority_filters").trigger("change")}),o.on("click",".switch-priority",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).closest(".list-group-item");t.removeClass("active").removeAttr("style"),$(this).find(".glyphicon-remove").removeClass("glyphicon-remove").addClass("glyphicon-plus"),$("#disabled_priorities").append(t).trigger("sortreceive"),o.trigger("sortremove")}),o.on("click","li:not(.disabled)",function(){$(this).toggleClass("active"),o.find("li.active:visible").length>0?$("#disable_selected_priorities").removeClass("disabled"):$("#disable_selected_priorities").addClass("disabled")}),t.resolve()},i=$('[data-anchor="enabled_priorities"]');return i.load("templates/enabledPrioritiesView.htm",function(e,r,n){n.done(function(){t.notify("rendered"),commonsModule.initBlock(i),o()})}),{deferred:t}}(),disabledPrioritiesModule=function(){var e={sortable:{connectWith:"ul",cursor:"move",forcePlaceholderSize:!0,handle:":not(.disabled)",helper:"clone",items:"> li:not(.disabled)",opacity:.8,placeholder:"ui-sortable-placeholder",revert:!0,scroll:!0,tolerance:"pointer"},mixitupPriorities:{animation:{animateChangeLayout:!0,animateResizeTargets:!0,effects:"fade rotateX(-40deg) translateZ(-100px)"},layout:{},load:{filter:".popular"},selectors:{target:".mix",filter:"#disabled_priorities_filters .filter",sort:"#disabled_priorities_form .sort"}}},t=new $.Deferred,o=function(){console.time("Priorities restored from cookies");var e=$("#stored_priorities");e&&$().garlic&&e.garlic({excluded:"",onRetrieve:function(e,t){$.each(t.split(","),function(e,t){$("#"+t).find(".glyphicon-plus").removeClass("glyphicon-plus").addClass("glyphicon-remove"),$("#"+t).appendTo("#enabled_priorities")})}}),$("#enabled_priorities").trigger("sortreceive"),console.timeEnd("Priorities restored from cookies")},i=function(){console.time("_disabledPrioritiesButtonState function executed");var e=$("#disabled_priorities");e.find("li:visible").length>0?$("#enable_all_priorities").removeClass("disabled"):($("#enable_all_priorities").addClass("disabled"),$("#enable_selected_priorities").addClass("disabled")),e.find("li.active:visible").length>0?$("#enable_selected_priorities").removeClass("disabled"):$("#enable_selected_priorities").addClass("disabled"),console.timeEnd("_disabledPrioritiesButtonState function executed")},r=function(){commonsModule.initBlock("#disabled_priorities_modal");var r=$("#disabled_priorities");$("#disabled_priorities_modal").one("shown.bs.modal",function(){r.mixItUp("isLoaded")||(console.log("Load MixItUp on #disabled_priorities"),r.mixItUp(e.mixitupPriorities),r.on("mixEnd",function(){i()}),$("#disabled_priorities_filters").val(e.mixitupPriorities.load.filter||"all").on("change",function(){r.mixItUp("filter",this.value),console.log("Disabled priorities filter changed to "+this.value)}),$("#disabled_priorities_layout").on("change",function(){r.mixItUp("changeLayout",{containerClass:this.value}),console.log("Disabled priorities layout changed to "+this.value)}).trigger("change"))}).on("shown.bs.modal",function(){r.mixItUp("isLoaded")}),r.sortable(e.sortable).disableSelection().on("sortstop sortreceive sortremove",function(){var e=$(this).sortable("toArray");$.each(e,function(e,t){"speaking_language_priority"===t&&$("#user_speaking_languages").prop("required",!1),"reading_language_priority"===t&&$("#user_reading_languages").prop("required",!1),"visa_free_priority"===t&&$("#user_citizenships").prop("required",!1),"currency_priority"!==t&&"change_rate_priority"!==t||$("#user_currencies").prop("required",!1),"ac_plugs_priority"!==t&&"ac_voltages_priority"!==t||($("#user_plug_types").prop("required",!1),$("#user_plug_voltages").prop("required",!1)),"income_level_priority"===t&&$("#user_income_level").prop("required",!1)}),i()}).trigger("sortstop"),$("#enable_selected_priorities").on("click",function(e){e.preventDefault();var t=[];$.each(r.find("li.active:visible"),function(){$(this).removeClass("active").removeAttr("style").show(),$(this).find(".glyphicon-plus").removeClass("glyphicon-plus").addClass("glyphicon-remove"),t.push($(this))}),$("#enabled_priorities").append(t).trigger("sortreceive"),r.trigger("sortremove")}),r.on("click","li:not(.disabled)",function(){$(this).toggleClass("active"),i()}),$.when(enabledPrioritiesModule.deferred).done(function(){o(),$("#enable_all_priorities").on("click",function(e){e.preventDefault();var t=[];$.each(r.find("li:visible"),function(){$(this).removeClass("active").removeAttr("style").show(),$(this).find(".glyphicon-plus").removeClass("glyphicon-plus").addClass("glyphicon-remove"),t.push($(this))}),$("#enabled_priorities").append(t).trigger("sortreceive"),r.trigger("sortremove")}),r.on("click",".switch-priority",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).closest(".list-group-item");t.removeClass("active").removeAttr("style"),$(this).find(".glyphicon-plus").removeClass("glyphicon-plus").addClass("glyphicon-remove"),$("#enabled_priorities").append(t).trigger("sortreceive"),r.trigger("sortremove"),console.log("Priority switched")}),r.on("click",".bootstrap-switch-container",function(e){e.preventDefault(),e.stopPropagation()}),t.resolve()})};return commonsModule.getCompiledTemplate("templates/disabledPrioritiesModal.hbs","data/priorities.json").done(function(e){$(function(){var o=$('[data-anchor="disabled_priorities_modal"]');o.html(e),t.notify("rendered"),commonsModule.initBlock(o),r()})}),{deferred:t}}(),userProfileModule=function(){var e=new $.Deferred,t=function(e){console.time("populateUserProfile("+e+")");var t,o,i,r,n=[];$.when(dataModule.deferred).done(function(){return(o=dataModule.countries[e])?($("#user_country").val()||$("#user_country").val(o.ISO).trigger("change").trigger("chosen:updated"),$("#user_citizenships").val(o.ISO).trigger("change").trigger("chosen:updated"),$("#user_currencies").val(o.currency.CurrencyCode).trigger("change").trigger("chosen:updated"),$("#user_income_level").val(o.incomeLevel?dataModule.oecdIncomeLevels[o.incomeLevel.id]:"").trigger("change").trigger("chosen:updated"),$("#user_driving_sides").val(o.drivingSide).trigger("change").trigger("chosen:updated"),o.languagePopulation&&(t=$("#user_speaking_languages"),$.each(o.languagePopulation,function(e,o){"official"===o.officialStatus&&t.val(o.type.toLowerCase()).trigger("change").trigger("chosen:updated")}),t=$("#user_reading_languages"),$.each(o.languagePopulation,function(e,o){"official"===o.officialStatus&&t.val(o.type.toLowerCase()).trigger("change").trigger("chosen:updated")})),o.plugs&&(n=[],$.each(o.plugs,function(e,t){n=$.union(n,[t.plugType])}),$("#user_plug_types").val(n).trigger("change").trigger("chosen:updated"),n=[],$.each(o.plugs,function(e,t){n=$.union(n,t.electricPotentials)}),$("#user_plug_voltages").val(n).trigger("change").trigger("chosen:updated"),n=[],$.each(o.plugs,function(e,t){n=$.union(n,t.frequencies)}),$("#user_plug_frequencies").val(n).trigger("change").trigger("chosen:updated")),o.measurementSystem&&o.measurementSystem.MeasurementSystem&&$("#user_measurement_system").val(o.measurementSystem.MeasurementSystem).trigger("change").trigger("chosen:updated"),o.religions&&($.each(o.religions,function(e,t){t.percent&&(t.percent>i||!i)&&(i=~~t.percent,r=e)}),$("#user_religion").val(r).trigger("change").trigger("chosen:updated")),$("#user_profile_form").bootstrapValidator("validate"),console.timeEnd("populateUserProfile("+e+")"),!0):(console.warn("country "+e+" have no data"),console.log("dataModule.countries["+e+"]",o),console.log("dataModule.countries",dataModule.countries),!1)})},o=function(){$.when(dataModule.deferred).done(function(){$("#user_currencies").on("change",function(){$(this).val()&&(userData.currencies={},$.each($(this).val(),function(e,t){dataModule.currencies[t]&&(userData.currencies[t]={},userData.currencies[t].changeRate=dataModule.currencies[t].rate)}))})}),e.resolve()},i=$('[data-anchor="user_profile"]');return i.load("templates/userProfileView.htm",function(){$("#user_country").load("templates/countryOptions.htm"),$("#user_citizenships").load("templates/countryOptions.htm"),$("#user_currencies").load("templates/currencyOptions.htm"),$("#user_speaking_languages").load("templates/languageOptions.htm"),$("#user_reading_languages").load("templates/languageOptions.htm"),e.notify("rendered"),commonsModule.initBlock(i),o()}),{deferred:e,populateUserProfile:t}}(),userProfileResetModule=function(){var e=new $.Deferred,t=function(){$("#user_profile_reset_modal").one("shown.bs.modal",function(){console.time("#user_profile_reset_modal initialisation");$("#user_profile_reset_form");$("#user_profile").focus().trigger("chosen:activate"),console.timeEnd("#user_profile_reset_modal initialisation")}),$("#user_profile_reset_form").on("submit",function(e){e.preventDefault();var t=$(this);if(t.parsley().isValid()){var o=$("#user_profile");userProfileModule.populateUserProfile(o.val().toLowerCase())}$("#profile_modal").modal("hide")}),e.resolve()},o=$('[data-anchor="user_profile_reset_modal"]');return o.load("templates/userProfileResetModal.htm",function(i,r,n){n.done(function(){$("#user_profile").load("templates/countryOptions.htm"),e.notify("rendered"),commonsModule.initBlock(o),t()})}),{deferred:e}}(),faqModule=function(){var e={mixitupFaq:{animation:{animateChangeLayout:!0,animateResizeTargets:!0,effects:"fade rotateX(-40deg) translateZ(-100px)"},layout:{display:"block"},load:{filter:".application"},selectors:{filter:"#faq_filters .filter"}}},t=new $.Deferred,o=function(){var t=$('a[data-toggle="tab"]');t.filter('[href="#help_pane"]').one("shown.bs.tab",function(){$("#faq_list").mixItUp("isLoaded")||(console.log("Load MixItUp on #faq_list"),$("#faq_list").mixItUp(e.mixitupFaq))})};return commonsModule.getCompiledTemplate("templates/faqView.hbs","data/faqView.json").done(function(e){$(function(){var i=$('[data-anchor="faq"]');i.html(e),t.notify("rendered"),commonsModule.initBlock(i),o()})}),{deferred:t}}(),contactModule=function(){var e=new $.Deferred,t=function(){return $().bootstrapValidator?void e.resolve():(console.warn("bootstrapValidator is not defined"),!1)},o=$('[data-anchor="contact"]');return o.load("templates/contactView.htm",function(i,r,n){n.done(function(){e.notify("rendered"),commonsModule.initBlock(o),t()})}),{deferred:e}}(),questionFormModule=function(){var e=new $.Deferred,t=function(){$("#question_modal").on("shown.bs.modal",function(){console.time("Show #question_modal"),$.when(i18nModule.deferred).done(function(){var e=$("#ss-form-question");e.bootstrapValidator($.extend({},appModule.options.bootstrapValidator,{fields:{questionContent:{selector:"#entry_1152240230",validators:{notEmpty:{message:i18nModule.i18next.t("fields:default.messages.notEmpty")}}}}})).end().on("change",function(){var t=$(this);t.attr("id")&&e.bootstrapValidator("revalidateField",t.attr("id"))})}),console.timeEnd("Show #question_modal")}),e.resolve()},o=$('[data-anchor="question_form_modal"]');return o.load("templates/questionFormModal.htm",function(i,r,n){n.done(function(){e.notify("rendered"),commonsModule.initBlock(o),t()})}),{deferred:e}}(),contributionModule=function(){var e=new $.Deferred,t=function(){$(".navbar").find('[href="#contribution_pane"]').one("shown.bs.tab",function(){})},o=$('[data-anchor="contribution"]');return o.load("templates/contributionView.htm",function(i,r,n){n.done(function(){e.notify("rendered"),commonsModule.initBlock(o),t()})}),{deferred:e}}(),mapLayersModule=function(){function e(e,t){var o,i,r,n,a,s,l,c,u,d,g,p,m,f,h,y=e[0],v=y.width,b=y.height,w=y.data,$=new Uint8ClampedArray(w.length),P=2*t.resolution,M=v-1,S=b-1,_=[0,0,0,0],x=2*Math.PI,C=Math.PI/2,L=Math.PI*t.sunEl/180,T=Math.PI*t.sunAz/180,k=Math.cos(L),I=Math.sin(L);for(i=0;S>=i;++i)for(a=0===i?0:i-1,s=i===S?S:i+1,o=0;M>=o;++o)r=0===o?0:o-1,n=o===M?M:o+1,l=4*(i*v+r),_[0]=w[l],_[1]=w[l+1],_[2]=w[l+2],_[3]=w[l+3],c=t.vert*(_[0]+2*_[1]+3*_[2]),l=4*(i*v+n),_[0]=w[l],_[1]=w[l+1],_[2]=w[l+2],_[3]=w[l+3],u=t.vert*(_[0]+2*_[1]+3*_[2]),d=(u-c)/P,l=4*(a*v+o),_[0]=w[l],_[1]=w[l+1],_[2]=w[l+2],_[3]=w[l+3],c=t.vert*(_[0]+2*_[1]+3*_[2]),l=4*(s*v+o),_[0]=w[l],_[1]=w[l+1],_[2]=w[l+2],_[3]=w[l+3],u=t.vert*(_[0]+2*_[1]+3*_[2]),g=(u-c)/P,p=Math.atan(Math.sqrt(d*d+g*g)),m=Math.atan2(g,-d),m=0>m?C-m:m>C?x-m+C:C-m,f=I*Math.cos(p)+k*Math.sin(p)*Math.cos(T-m),l=4*(i*v+o),h=255*f,$[l]=h,$[l+1]=h,$[l+2]=h,$[l+3]=w[l+3];return new ImageData($,v,b)}var t=new $.Deferred,o={},i={bingMapsKey:"Ak-dzM4wZjSqTlzveKz5u0d4IQ4bRzVI309GxmkgSVr1ewS6iPSrOvOKhA-CJlm3",properties:{visible:!1,preload:"Infinity"}},r=function(e){$.extent(i,e)},n=function(e,t){if(!$.isFunction(o[e]))return console.warn(e+" layer definition is not defined"),!1;var r=o[e]();return r.setProperties(i.properties),t&&r.setProperties(t),r},a=function(e){var t=0,o=e.get("name"),i=o.match(/([\-+]\d{2}):(\d{2})$/);if(i){var r=parseInt(i[1],10),n=parseInt(i[2],10);t=60*r+n}var a=new Date,s=new Date(a.getTime()+6e4*(a.getTimezoneOffset()+t)),l=Math.abs(12-s.getHours()+s.getMinutes()/60);l>12&&(l=24-l);var c=.75*(1-l/12);return[new ol.style.Style({fill:new ol.style.Fill({color:[85,85,85,c]}),stroke:new ol.style.Stroke({color:"#ffffff"})})]};return o.openStreetMap=function(){return new ol.layer.Tile({name:"openStreetMap",title:"Road Map<small> (by OpenStreetMap)</small>",visible:!0,type:"base",source:new ol.source.OSM({urls:["http://a.tile.openstreetmap.org/{z}/{x}/{y}.png"]})})},o.openSeaMap=function(){return new ol.layer.Tile({name:"openSeaMap",title:"Shipping lanes<small> (by OpenSeaMap)</small>",type:"base",source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.openseamap.org/">OpenSeaMap</a>'}),ol.source.OSM.ATTRIBUTION],crossOrigin:null,urls:["http://tiles.openseamap.org/seamark/{z}/{x}/{y}.png","http://t1.openseamap.org/seamark/{z}/{x}/{y}.png"]})})},o.openStreetMapHumanitarian=function(){return new ol.layer.Tile({name:"openStreetMapHumanitarian",title:"Humanitarian <small>(by OpenStreetMap)</small>",type:"base",source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.openstreetmap.fr/">OpenStreetMap</a>'}),ol.source.OSM.ATTRIBUTION],url:"http://tile-{a-c}.openstreetmap.fr/hot/{z}/{x}/{y}.png"})})},o.mapquestOSM=function(){return new ol.layer.Tile({name:"mapquestOSM",title:"Road map<small> (by MapQuest)</small>",type:"base",source:new ol.source.MapQuest({layer:"osm"})})},o.mapquestSat=function(){return new ol.layer.Tile({name:"mapquestSat",title:"Aerial view<small> (by MapQuest)</small>",type:"base",source:new ol.source.MapQuest({layer:"sat"})})},o.openCycleMap=function(){return new ol.layer.Tile({name:"openCycleMap",title:"Cycling roads<small> (by OpenCycleMap)</small>",type:"base",source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.opencyclemap.org/">OpenCycleMap</a>'}),ol.source.OSM.ATTRIBUTION],url:"http://{a-c}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png"})})},o.thunderforestTransport=function(){return new ol.layer.Tile({name:"thunderforestTransport",title:"Transports<small> (by ThunderForest)</small>",type:"base",source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.thunderforest.com/">ThunderForest</a>'}),ol.source.OSM.ATTRIBUTION],url:"http://{a-c}.tile.thunderforest.com/transport/{z}/{x}/{y}.png"})})},o.thunderforestTransportDark=function(){return new ol.layer.Tile({name:"thunderforestTransportDark",title:"Transport dark<small> (by ThunderForest)</small>",type:"base",source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.thunderforest.com/">ThunderForest</a>'}),ol.source.OSM.ATTRIBUTION],url:"https://{a-c}.tile.thunderforest.com/transport-dark/{z}/{x}/{y}.png"})})},o.thunderforestLandscape=function(){return new ol.layer.Tile({name:"thunderforestLandscape",title:"Landscape<small> (by ThunderForest)</small>",type:"base",source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.thunderforest.com/">ThunderForest</a>'}),ol.source.OSM.ATTRIBUTION],url:"https://{a-c}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png"})})},o.thunderforestOutdoor=function(){return new ol.layer.Tile({name:"thunderforestOutdoor",title:"Outdoor activities<small> (by ThunderForest)</small>",type:"base",source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.thunderforest.com/">ThunderForest</a>'}),ol.source.OSM.ATTRIBUTION],url:"https://{a-c}.tile.thunderforest.com/outdoors/{z}/{x}/{y}.png"})})},o.arcgis=function(){return new ol.layer.Tile({name:"arcgis",title:"Terrain<small> (by ArcGIS)</small>",type:"base",source:new ol.source.XYZ({crossOrigin:"anonymous",attributions:[new ol.Attribution({html:'Tiles &copy; <a href="http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer">ArcGIS</a>'})],url:"http://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}"})})},o.arcgisRestHighwayUSA=function(){return new ol.layer.Tile({name:"arcgisRestHighwayUSA",title:"Highway USA<small> (by ArcGIS)</small>",type:"base",extent:[-13884991,2870341,-7455066,6338219],source:new ol.source.TileArcGISRest({url:"http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Specialty/ESRI_StateCityHighway_USA/MapServer"})})},o.googleTerrain=function(){return new ol.layer.Tile({name:"googleTerrain",title:"Terrain + labels<small> (by Google)</small>",type:"base",source:new ol.source.XYZ({crossOrigin:"anonymous",url:"http://mts0.google.com/vt/lyrs=t@132,r@285000000&hl=en&src=app&x={x}&y={y}&z={z}&s=1"})})},o.googleSatellite=function(){return new ol.layer.Tile({name:"googleSatellite",title:"Aerial view<small> (by Google)</small>",type:"base",source:new ol.source.XYZ({crossOrigin:"anonymous",url:"http://khms0.google.com/kh/v=165&src=app&x={x}&y={y}&z={z}&s=1"})})},o.bingRoad=function(){return new ol.layer.Tile({name:"bingRoad",title:"Road map<small> (by Bing)</small>",type:"base",maxZoom:19,source:new ol.source.BingMaps({key:i.bingMapsKey,imagerySet:"Road"})})},o.bingAerial=function(){return new ol.layer.Tile({name:"bingAerial",title:"Aerial view<small> (by Bing)</small>",type:"base",maxZoom:19,source:new ol.source.BingMaps({key:i.bingMapsKey,imagerySet:"Aerial"})})},o.bingAerialWithLabels=function(){return new ol.layer.Tile({name:"bingAerialWithLabels",title:"Aerial view with labels<small> (by Bing)</small>",type:"base",maxZoom:19,source:new ol.source.BingMaps({key:i.bingMapsKey,imagerySet:"AerialWithLabels"})})},o.bingCollinsBart=function(){return new ol.layer.Tile({name:"bingCollinsBart",title:"CollinsBart<small> (by Bing)</small>",type:"base",maxZoom:19,source:new ol.source.BingMaps({key:i.bingMapsKey,imagerySet:"collinsBart"})})},o.bingOrdnanceSurvey=function(){return new ol.layer.Tile({name:"bingOrdnanceSurvey",title:"OrdnanceSurvey<small> (by Bing)</small>",type:"base",maxZoom:19,source:new ol.source.BingMaps({key:i.bingMapsKey,imagerySet:"ordnanceSurvey"})})},o.stamenToner=function(){return new ol.layer.Tile({name:"stamenToner",title:"B&W map<small> (by Stamen)</small>",type:"base",source:new ol.source.Stamen({layer:"toner"})})},o.stamenTonerLite=function(){return new ol.layer.Tile({name:"stamenTonerLite",title:"Gray scale map<small> (by Stamen)</small>",type:"base",source:new ol.source.Stamen({layer:"toner-lite"})})},o.stamenTonerBackground=function(){return new ol.layer.Tile({name:"stamenTonerBackground",title:"B&W background<small> (by Stamen)</small>",type:"base",source:new ol.source.Stamen({layer:"toner-background"})})},o.stamenWatercolor=function(){return new ol.layer.Tile({name:"stamenWatercolor",title:"Watercolor map<small> (by Stamen)</small>",type:"base",source:new ol.source.Stamen({layer:"watercolor"})})},o.stamenTerrain=function(){return new ol.layer.Tile({name:"stamenTerrain",title:"Terrain USA<small> (by Stamen)</small>",type:"base",source:new ol.source.Stamen({layer:"terrain"})})},o.stamenTerrainWithLabels=function(){return new ol.layer.Tile({name:"stamenTerrainLabels",title:"Terrain + labels USA<small> (by Stamen)</small>",type:"base",source:new ol.source.Stamen({layer:"terrain-labels"})})},o.googleBike=function(){
return new ol.layer.Tile({name:"googleBike",title:"Cycling roads<small> (by Google)</small>",visible:!0,opacity:1,source:new ol.source.XYZ({crossOrigin:"anonymous",url:"http://mts0.google.com/vt/lyrs=h@239000000,bike&hl=en&src=app&x={x}&y={y}&z={z}&s=1"})})},o.mapquestHyb=function(){return new ol.layer.Tile({name:"mapquestHyb",title:"City names<small> (by MapQuest)</small>",source:new ol.source.MapQuest({layer:"hyb"})})},o.lonviaCycling=function(){return new ol.layer.Tile({name:"lonviaCycling",title:"Cycling roads<small> (by Lonvia)</small>",opacity:.7,source:new ol.source.OSM({attributions:[new ol.Attribution({html:'Map data &copy; <a href="http://www.openstreetmap.org/">OpenStreetMap</a> and contributors <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'}),ol.source.OSM.ATTRIBUTION],crossOrigin:null,url:"http://tile.lonvia.de/cycling/{z}/{x}/{y}.png"})})},o.lonviaHiking=function(){return new ol.layer.Tile({name:"lonviaHiking",title:"Hiking paths<small> (by Lonvia)</small>",opacity:.7,source:new ol.source.OSM({attributions:[new ol.Attribution({html:'Map data &copy; <a href="http://www.openstreetmap.org/">OpenStreetMap</a> and contributors <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'}),ol.source.OSM.ATTRIBUTION],crossOrigin:null,url:"http://tile.lonvia.de/hiking/{z}/{x}/{y}.png"})})},o.stamenTonerHybrid=function(){return new ol.layer.Tile({name:"stamenTonerHybrid",title:"B&W roads + labels<small> (by Stamen)</small>",source:new ol.source.Stamen({layer:"toner-hybrid"})})},o.stamenTonerLabels=function(){return new ol.layer.Tile({name:"stamenTonerLabels",title:"B&W labels<small> (by Stamen)</small>",source:new ol.source.Stamen({layer:"toner-labels"})})},o.stamenTonerLines=function(){return new ol.layer.Tile({name:"stamenTonerLines",title:"B&W roads<small> (by Stamen)</small>",source:new ol.source.Stamen({layer:"toner-lines"})})},o.mapboxShadedRelief=function(){return new ol.layer.Image({name:"mapboxShadedRelief",title:"Shaded relief<small> (by Mapbox)</small>",source:new ol.source.Raster({sources:[new ol.source.XYZ({url:"https://{a-d}.tiles.mapbox.com/v3/aj.sf-dem/{z}/{x}/{y}.png",crossOrigin:"anonymous"})],operationType:"image",operation:e}),opacity:.3})},o.timeZones=function(){return new ol.layer.Vector({name:"timeZones",title:"Time zones",style:a,minResolution:4891,source:new ol.source.Vector({extractStyles:!1,projection:"EPSG:3857",url:"data/timezones.kml",format:new ol.format.KML})})},o.gpxFile=function(){return new ol.layer.Vector({name:"gpxFile",title:"GPS tracks",visible:!1,source:new ol.source.Vector({}),style:new ol.style.Style({stroke:new ol.style.Stroke({color:"rgba(51, 122, 183, 0.7)",width:3})})})},o.drawingVector=function(){return new ol.layer.Tile({name:"drawing",title:"My drawings"})},{deferred:t,create:n,config:r}}(),geolocationModule=void 0,mapControlsModule=function(){console.time("Map controls initialized");var e=new $.Deferred,t=new ol.control.Attribution({collapsible:!0}),o=new ol.control.ZoomToExtent({}),i=new ol.control.ScaleLine({}),r=new ol.control.MousePosition({coordinateFormat:ol.coordinate.createStringXY(4),projection:"EPSG:4326",className:"custom-mouse-position",target:document.getElementById("mouse-position"),undefinedHTML:"&nbsp;"}),n=new ol.control.LayerSwitcher({}),a=new ol.control.FullScreen({}),s=new ol.control.OverviewMap({className:"ol-overviewmap ol-custom-overviewmap",collapseLabel:"«",label:"»",collapsed:!0});$.when(mapLayersModule.deferred).done(function(){s.setProperties({layers:[mapLayersModule.baselayers]})}),$(function(){var e=$("#units");e.on("change",function(){i.setUnits(this.value)}),e.val(i.getUnits());var t=$("#projection");t.on("change",function(){r.setProjection(ol.proj.get(this.value))}),t.val(r.getProjection().getCode());var o=$("#precision");o.on("change",function(){var e=ol.coordinate.createStringXY(this.valueAsNumber);r.setCoordinateFormat(e)})});var l=ol.control.defaults({attribution:!1,attributionOptions:{collapsible:!1},zoomOptions:{}}).extend([t,r,i,s,o,a,n]);return e.resolve(),$.when(i18nModule.deferred).done(function(){t.setProperties({tipLabel:i18nModule.i18next.t("buttons:olAttribution.label")}),o.setProperties({tipLabel:i18nModule.i18next.t("buttons:olZoomExtent.label")}),i.setProperties({tipLabel:i18nModule.i18next.t("buttons:olScaleLine.label")}),n.setProperties({tipLabel:i18nModule.i18next.t("buttons:olLayerswitcher.label")}),a.setProperties({tipLabel:i18nModule.i18next.t("buttons:olFullScreen.label")}),s.setProperties({tipLabel:i18nModule.i18next.t("buttons:olOverviewmap.label")}),l.setProperties({zoomOptions:{zoomInTipLabel:i18nModule.i18next.t("buttons:olZoomIn.label"),zoomOutTipLabel:i18nModule.i18next.t("buttons:olZoomOut.label")}}),console.log("Map controls translated")}),{deferred:e,controls:l,layerSwitcher:n,overviewMapControl:s}}(),mapOverlaysModule=function(){console.time("Map overlays initialized");var e=new $.Deferred,t=new ol.Overlay({offset:[15,15],stopEvent:!1}),o=new ol.Overlay({positioning:"bottom-center",stopEvent:!1}),i=[t,o];return e.resolve(),$(function(){var e=document.getElementById("country-info");t.setProperties({element:e});var i=document.getElementById("popup");o.setProperties({element:i})}),{deferred:e,overlays:i,infoOverlay:t,popup:o}}();console.timeEnd("Map overlays initialized");var mapInteractionsModule=function(){console.time("Map interactions initialized");var e,t,o,i,r,n=new $.Deferred;e=null,t=new ol.interaction.Select,o=new ol.interaction.Select({condition:ol.events.condition.click}),i=new ol.interaction.Select({condition:ol.events.condition.pointerMove});var a=function(n){null!==e&&n.removeInteraction(e);var a=r.value;e="singleclick"===a?t:"click"===a?o:"pointermove"===a?i:null,null!==e&&(n.addInteraction(e),e.on("select",function(e){e.selected&&$("#status").html("&nbsp;"+e.target.getFeatures().getLength()+" selected features (last operation selected "+e.selected.length+" and deselected "+e.deselected.length+" features)")}))};$(function(){r=document.getElementById("action_type"),$.when(appModule.deferred.ready.map,appModule.deferred.load.mapSettings).done(function(){r.onchange=a,a(map)})});var s=ol.interaction.defaults({}).extend([new ol.interaction.DragRotateAndZoom]);return n.resolve(),{deferred:n,interactions:s}}();console.timeEnd("Map interactions initialized");var mapInputsModule=function(){var e=(new $.Deferred,{});return e.zoom=function(e,t){var o=$(e);o&&(o.val(t.getView().getZoom()),o.on("input change",function(){var e=o.val();(e||0===e)&&t.getView().setZoom(e)}),t.getView().on("change:resolution",function(){o.val(this.getZoom())}))},e.resolution=function(e,t){var o=$(e);o&&(o.val(t.getView().getResolution()),o.on("input change",function(){var e=o.val();(e||0===e)&&t.getView().setResolution(e)}),t.getView().on("change:resolution",function(){o.val(this.getResolution())}))},e.rotation=function(e,t){var o=$(e);o&&(o.val(t.getView().getRotation()),o.on("input change",function(){var e=o.val();(e||0===e)&&t.getView().setRotation(e)}),t.getView().on("change:rotation",function(){o.val(this.getRotation())}))},e.centerX=function(e,t){var o=$(e);if(o){var i=t.getView().getCenter();o.val(i[0]),t.getView().on("change:center",function(){i=this.getCenter(),o.val(i[0])})}},e.centerY=function(e,t){var o=$(e);if(o){var i=t.getView().getCenter();o.val(i[1]),t.getView().on("change:center",function(){i=this.getCenter(),o.val(i[1])})}},e.center=function(t,o,i){e.centerX(t,i),e.centerY(o,i);var r=$(t),n=$(o);r&&n&&$(t+", "+o).on("input change",function(){var e=r.val(),t=n.val();!e&&0!==e||!t&&0!==t||i.getView().setCenter(e,t)})},e.exportPNG=function(e,t){var o=$(e);o&&o.on("click",function(){t.once("postcompose",function(e){var t=e.context.canvas;o.attr("href",t.toDataURL("image/png"))})})},e}(),mapEventsModule=function(e){console.time("Map events initialized");var t,o=new $.Deferred;return $(function(){document.getElementById("popup");t=$("#map-tooltip"),t.tooltip({animation:!1,trigger:"manual"})}),{deferred:o}}(),mapModule=function(){console.time("Map initialized");var e,t=new $.Deferred,o=new ol.source.Vector({url:"data/countries.geojson",format:new ol.format.GeoJSON}),i=function(){e.render()},r=function(t,o,i){var r=e.getView();r.setCenter(ol.proj.transform([t,o],"EPSG:4326","EPSG:3857")),i&&r.setZoom(i),console.log("Map centered at longitude: "+t+" latitude: "+o+" zoom: "+i)},n=function(t){var i=o,r=i.getFeatureById(t),n=r.getGeometry(),a=e.getSize(),s=e.getView();s.fitGeometry(n,a,{padding:[0,0,0,0],constrainResolution:!1})},a=function(e){var t,o=0,i=e.getId();dataModule.countries&&appModule.countryCodesISO2[i]&&(i=appModule.countryCodesISO2[i].toLowerCase(),dataModule.countries[i]&&dataModule.countries[i].percent&&(o=dataModule.countries[i].percent)),t=(o||0)/100*.8;var r=new ol.style.Style({fill:new ol.style.Fill({color:[51,255,0,t]})});return[r]},s=function(t){var o=e.forEachFeatureAtPixel(t,function(e){return e});if(o){var i=o.getId();console.log("Show feature "+i+' "'+o.get("name")+'"'),countryDetailsModule.showCountryDetails(i,"ISO3"),$("#country_details").modal("show")}},l=function(t){mapTooltip.css({left:t[0]+"px",top:t[1]-15+"px"});var o=e.forEachFeatureAtPixel(t,function(e){return e});o?mapTooltip.tooltip("hide").attr("data-original-title",o.get("name")).tooltip("fixTitle").tooltip("show"):mapTooltip.tooltip("hide")},c=function(e){var t,o=0,i=e.getId();dataModule.countries&&appModule.countryCodesISO2[i]&&(i=appModule.countryCodesISO2[i].toLowerCase(),dataModule.countries[i]&&dataModule.countries[i].missingDataPercent&&(o=dataModule.countries[i].missingDataPercent)),t=(o||0)/100*.8;var r=new ol.style.Style({fill:new ol.style.Fill({color:[136,136,136,t]})});return[r]},u=function(e,t){var o,i,r,n,a;r=0,n=0,a=e.getId(),dataModule.countries&&appModule.countryCodesISO2[a]&&(a=appModule.countryCodesISO2[a].toLowerCase(),dataModule.countries[a]&&dataModule.countries[a].percent&&(r=dataModule.countries[a].percent),dataModule.countries[a]&&dataModule.countries[a].missingDataPercent&&(n=dataModule.countries[a].missingDataPercent)),o=(r||0)/100*.6+.4,i=(n||0)/100*1;var s=new ol.style.Style({text:new ol.style.Text({font:"1.25em bold Calibri,sans-serif",fill:new ol.style.Fill({color:[168*i,84*i,0,o]}),stroke:new ol.style.Stroke({color:[255,255,255,.5*o],width:1})})});return r>=0&&s.getText().setText(t>300?r.toFixed()+"%":""),[s]},d=mapLayersModule.create("openStreetMap",{visible:!0}),g=mapLayersModule.create("openCycleMap"),p=mapLayersModule.create("openSeaMap"),m=mapLayersModule.create("mapquestOSM"),f=mapLayersModule.create("mapquestSat"),h=mapLayersModule.create("arcgis"),y=mapLayersModule.create("stamenTerrainWithLabels"),v=mapLayersModule.create("mapquestHyb"),b=mapLayersModule.create("lonviaCycling"),w=mapLayersModule.create("lonviaHiking"),P=mapLayersModule.create("timeZones"),M=mapLayersModule.create("gpxFile");$("#gpx_file_path").on("change",function(e){var t=e.target.files;bootstrapModule.inputFileList(t,"#gpx_file_list")});var S=new ol.layer.Group({name:"roadOverlays",layers:[v,w,b]}),_=new ol.layer.Group({name:"informationOverlays",layers:[P,M]}),x=new ol.layer.Vector({name:"scores",title:"Scores",visible:!0,minResolution:200,source:o}),C=new ol.layer.Vector({name:"destinations",title:"My destinations",visible:!0,minResolution:200,source:o}),L=new ol.layer.Vector({name:"missingData",title:"Missing data",visible:!1,minResolution:200,source:o}),T=new ol.layer.Group({name:"roadBaselayers",layers:[p,g,m,d]}),k=new ol.layer.Group({name:"reliefBaselayers",layers:[y,h]}),I=new ol.layer.Group({name:"aerialBaselayers",layers:[f]}),O=new ol.layer.Group({name:"baseLayers",layers:[I,k,T]}),A=new ol.layer.Group({name:"userOverlays",layers:[C,L,x]}),R=new ol.layer.Group({name:"overlays",layers:[A,_,S]}),V=[O,R],B=ol.proj.get("EPSG:3857"),D=B.getExtent(),q=ol.extent.getCenter(D),F=new ol.View({center:q,extent:D,maxResolution:39135.76,projection:B,zoom:0}),z=function(){var o=document.getElementById("map");e=new ol.Map({logo:!1,view:F,controls:mapControlsModule.controls,interactions:mapInteractionsModule.interactions,layers:V,overlays:mapOverlaysModule.overlays,target:o,loadTilesWhileInteracting:!0});var i=document.getElementById("no-webgl");ol.has.WEBGL||(i.style.display=""),$('a[data-toggle="tab"]').on("shown.bs.tab",function(t){var o=$(t.target).attr("href");"#map_pane"===o&&(scoreModule.updateScores(),e.updateSize(),x.changed(),C.changed(),mapControlsModule.overviewMapControl.setMap(e),console.log("Map refreshed"))}),$(".ol-zoom-in, .ol-zoom-out, .ol-overviewmap button[title], .ol-zoom-extent button[title]").tooltip({placement:"right"}),$(".ol-rotate-reset, .ol-attribution button[title], .ol-full-screen button[title], .layer-switcher button[title]").tooltip({placement:"left"}),$(".layer-switcher button").addClass("ol-control"),e=e,e.on("change:layers",function(){ol.control.LayerSwitcher.forEachRecursive(e,function(e){e instanceof ol.layer.Group||!e.getVisible()||("base"===e.get("type")?imageryLayerActions(e):"vector"===e.get("type")?vectorLayerActions(e):selectedLayerActions(e))})}),geolocation=new ol.Geolocation({projection:e.getView().getProjection(),trackingOptions:{maximumAge:1e4,enableHighAccuracy:!0,timeout:6e5}});var r=new ol.geom.LineString([],"XYZM"),n=500,a=0,c=document.getElementById("geolocation_marker");e.addOverlay(new ol.Overlay({positioning:"center-center",element:c,stopEvent:!1})),e.beforeRender(function(e,t){if(null!==t){var o=t.time-1.5*n;o=Math.max(o,a),a=o;var i=r.getCoordinateAtM(o,!0),s=t.viewState;i&&(s.center=getCenterWithHeading(i,-i[2],s.resolution),s.rotation=-i[2],c.setPosition(i))}return!0}),$("#track").on("switchChange.bootstrapSwitch init",function(){if(console.info(this.checked?"#track is checked":"#track is not checked"),geolocation.setTracking(this.checked),this.checked){$("#user_address").closest(".form-group").addClass("hidden"),e.on("postcompose",e.render()),e.render();var t=geolocation.getPosition();t&&e.getView().setCenter(t)}else $("#user_address").closest(".form-group").removeClass("hidden")}),geolocation.on("error",function(e){var t=document.getElementById("map_alert");t.getElementsByTagName("div").innerHTML=e.message,t.style.display=""}),geolocation.on("change",function(){var t,o,i=geolocation.getPosition(),a=geolocation.getAccuracy(),s=geolocation.getHeading()||0,l=geolocation.getSpeed()||0,c=Date.now(),u=geolocation.getAltitude()||0,d=geolocation.getAltitudeAccuracy()||0;addPosition(i,s,c,l),t=r.getCoordinates(),o=t.length,o>=2&&(n=(t[o-1][3]-t[0][3])/(o-1));var g=e.getView(),p=g.getProjection(),m=p.getUnits();$.when(mapSettings.deferred).then(function(){$("#longitude").text(i[0].toFixed(2)+" "+m),$("#latitude").text(i[1].toFixed(2)+" "+m),$("#accuracy").text(a+" "+m),$("#heading").text(Math.round(radToDeg(s))+" deg"),$("#speed").text((3.6*l).toFixed(1)+" km/h"),$("#delta").text(Math.round(n)+" ms"),$("#altitude").text(u+" m"),$("#altitudeAccuracy").text(d+" m")})});var u=$("#center_map_on_user_location");u&&u.on("click",function(t){t.preventDefault();var o=geolocation.getPosition();o&&(e.getView().setCenter(o),console.log("Map centered on user position")),updateUserAddress()}),u=$("#display_geolocation_marker"),u&&u.on("switchChange.bootstrapSwitch",function(){this.checked?$("#geolocation_marker").removeClass("hidden"):$("#geolocation_marker").addClass("hidden")}).trigger("switchChange.bootstrapSwitch");var d=new ol.DeviceOrientation;d.on("change",function(){var e=d.getAlpha(),t=d.getBeta(),o=d.getGamma(),i=d.getHeading();$("#alpha").text(e),$("#alpha").text(e?radToDeg(e)+" deg":"-"),$("#beta").text(t?radToDeg(t)+" deg":"-"),$("#gamma").text(o?radToDeg(o)+" deg":"-"),$("#heading").text(i?radToDeg(i)+" deg":"-")}),d.on(["change:beta","change:gamma"],function(t){var o=e.getView(),i=o.getCenter(),r=o.getResolution(),n=t.target.getBeta()||0,a=t.target.getGamma()||0;i[0]-=r*a*25,i[1]+=r*n*25}),mapInputsModule.zoom("#zoom",e),mapInputsModule.resolution("#resolution",e),mapInputsModule.rotation("#rotation",e),mapInputsModule.center("#center_x","#center_y",e),mapInputsModule.exportPNG("#export-png",e);var g=$("#gps_mode");g.on("switchChange.bootstrapSwitch init",function(){this.checked&&(F=e.getView(),F.setZoom(14),console.log("Zoom increased"))}),e.on("click",function(e){l(e.pixel),s(e.pixel)}),e.on("pointermove",function(t){var o,i;return t.dragging?(mapTooltip.tooltip("hide"),!1):(o=e.getEventPixel(t.originalEvent),i=e.hasFeatureAtPixel(o),t.dragging?($(popupElement).popover("destroy"),!1):void(e.getTarget().style.cursor=i?"pointer":""))}),e.on("moveend",onMoveEnd);var p=e.getViewport();$(p).resize(function(){e.updateSize(),console.log("Map size updated")}),$(p).on("mousemove",function(t){var o=e.getEventPixel(t.originalEvent);l(o)}),console.timeEnd("Map events initialized"),t.resolve(),console.timeEnd("Map initialized")};$.when(dataModule.countries).then(function(){x.setProperties({style:u}),C.setProperties({style:a}),L.setProperties({style:c}),console.log("Map styles updated")}),$.when(i18nModule.deferred).done(function(){T.setProperties({title:i18nModule.i18next.t("sections:roadLayers.title")}),k.setProperties({title:i18nModule.i18next.t("sections:roadWithReliefLayers.title")}),I.setProperties({title:i18nModule.i18next.t("sections:satelliteLayers.title")}),O.setProperties({title:i18nModule.i18next.t("sections:baseLayer.title")}),S.setProperties({title:i18nModule.i18next.t("sections:roadLayers.title")}),_.setProperties({title:i18nModule.i18next.t("sections:infoLayers.title")}),A.setProperties({title:i18nModule.i18next.t("sections:myLayers.title")}),R.setProperties({title:i18nModule.i18next.t("sections:overlayLayers.title")}),_.setProperties({title:i18nModule.i18next.t("sections:infoLayers.title")}),console.log("Map layers translated")});var E=$('[data-anchor="map"]');return E.load("templates/mapView.htm",function(e,o,i){i.done(function(){t.notify("rendered"),commonsModule.initBlock(E),$.when(mapControlsModule.deferred,mapInteractionsModule.deferred,mapLayersModule.deferred,mapOverlaysModule.deferred).done(function(){$(function(){z()})})})}),{deferred:t,map:e,render:i,centerMap:r,fitCountry:n,displayFeatureTooltip:l,displayCountryDetails:s}}(),appModule=function(){var e={bootstrapValidator:{framework:"bootstrap",excluded:[":disabled"],live:"enabled"},chosen:{no_results_text:""},onepageScroll:{sectionContainer:".section"},popover:{container:"body",html:"true"},scrollReveal:{mobile:!0},tooltip:{animation:!0,container:"body",html:"true",delay:{show:900,hide:100}}},t={init:{i18next:new $.Deferred},load:{map:new $.Deferred,mapSettings:new $.Deferred},ready:{userProfile:new $.Deferred,userProfileReset:new $.Deferred,priorities:new $.Deferred,enabledPriorities:new $.Deferred,disabledPriorities:new $.Deferred,map:new $.Deferred,mapControls:new $.Deferred,mapInteractions:new $.Deferred,mapLayers:new $.Deferred,mapOverlays:new $.Deferred,mapSettings:new $.Deferred,appSettings:new $.Deferred}},o=[{id:"userProfile"},{id:"priorities"},{id:"results"}],i=function n(e,t){var i;return o[e]?100===o[e].percent&&o[e].percent===t?!1:(o[e].percent=t,i=$("#steps").find("div:nth-child("+(e+1)+") .surrounded"),i&&i.removeClass("text-success text-warning text-danger").addClass(100===t?"text-success":t>0?"text-warning":"text-danger"),i=$("#steps-progress"),i&&(i.find(".progress-bar:nth-child("+(e+1)+")").removeClass("progress-bar-success progress-bar-warning progress-bar-danger").addClass(100===t?"progress-bar-success":t>0?"progress-bar-warning":"progress-bar-danger"),i.find(".progress-bar").css("width",(100/o.length).toFixed(2)+"%")),void(2!==e&&n(2,(o[0].percent+o[1].percent)/2))):!1},r=function(){console.time("resizeSections function executed");var e=$(".navbar-fixed-top").filter(":visible"),t=$(".tab-pane.active .navbar-fixed-bottom").filter(":visible"),o=$(window).height(),i=e.height()||0,r=t.height()||0,n=e.outerHeight(!0)||0,a=t.filter(":visible").outerHeight(!0)||0,s=$("body").offset();$("body, .page, .section, .slide").css("min-height",o),$(".slide-no-padding").css("height",o),$(".slide-no-padding").css("padding-top",i).css("padding-bottom",r),$(".slide").css("padding-top",n).css("padding-bottom",a),console.log("Section height adjusted > "+o+"px"),console.log("Section padding adjusted > padding-top: "+n+"px, padding-bottom: "+a+"px"),console.log("Section without padding adjusted > padding-top: "+i+"px, padding-bottom: "+r+"px"),0===s.top&&0===s.left||console.warn("Body offset negative values > top: "+s.top+"px, left: "+s.left+"px"),console.timeEnd("resizeSections function executed")};return $(function(){$.when(i18nModule.deferred).done(function(){}),$('[data-anchor="steps"]').load("templates/stepsView.htm"),$('[data-anchor="map_settings"]').load("templates/mapSettingsView.htm"),$('[data-anchor="app_settings"]').load("templates/appSettingsView.htm"),commonsModule.initBlock("body"),$(window).resize(function(){r()}).trigger("resize");var e=$(".navbar-fixed-top, .navbar-fixed-bottom");e.resize(function(){r()}),$("#main-menu").find('a[data-toggle="tab"]').one("shown.bs.tab",function(){r()}),$("#main-menu").find('a[data-toggle="tab"]').one("shown.bs.tab",function(e){var t=$(e.target).attr("href"),o=t.replace("#","");$("section").removeClass().addClass(o),console.log("Body class changed to "+o)}),$(".panel-group").on("shown.bs.collapse hidden.bs.collapse",function(e){console.time("Show .panel-group"),$(e.target).prev(".panel-heading").find(".indicator").toggleClass("glyphicon-chevron-down glyphicon-chevron-up"),console.timeEnd("Show .panel-group")}),$(".dropdown-menu").find("form").on("click",function(e){e.stopPropagation()}),$(window).scroll(function(){var e=$(document).scrollTop();$(".background-image").css({"background-position":"0px -"+(e/3).toFixed(2)+"px"})})}),{options:e,validationStepPercent:i,deferred:t}}();